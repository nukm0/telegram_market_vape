<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vape Market | –ë–∞—Ä–∞—Ö–æ–ª–∫–∞ –¥–ª—è –≤–µ–π–ø–æ–≤</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase —Å–∫—Ä–∏–ø—Ç—ã -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        /* [–í–µ—Å—å –≤–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π CSS –∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π] */
        /* –§–∏–æ–ª–µ—Ç–æ–≤—ã–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã –¥–ª—è —Ñ–æ–Ω–∞ */
        :root {
            --gradient-primary: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 50%, #6D28D9 100%);
            --gradient-secondary: linear-gradient(135deg, #A78BFA 0%, #8B5CF6 50%, #7C3AED 100%);
            --gradient-dark: linear-gradient(135deg, #6D28D9 0%, #5B21B6 50%, #4C1D95 100%);
            --gradient-admin: linear-gradient(135deg, #F59E0B 0%, #D97706 50%, #B45309 100%);
            
            --button-primary: #7C3AED;
            --button-hover: #6D28D9;
            --button-active: #5B21B6;
            --button-success: #10B981;
            --button-error: #EF4444;
            --button-info: #3B82F6;
            --button-warning: #F59E0B;
            --button-admin: #F59E0B;
            
            --text-light: #FFFFFF;
            --text-dark: #1F2937;
            --text-muted: #9CA3AF;
            
            --shadow: 0 10px 25px -5px rgba(139, 92, 246, 0.3);
            --shadow-dark: 0 10px 25px -5px rgba(0, 0, 0, 0.4);
            --shadow-admin: 0 10px 25px -5px rgba(245, 158, 11, 0.3);
            
            --card-bg: rgba(255, 255, 255, 0.95);
            --card-bg-dark: rgba(30, 27, 75, 0.95);
            --card-bg-admin: rgba(245, 158, 11, 0.1);
        }
        
        /* –°–±—Ä–æ—Å —Å—Ç–∏–ª–µ–π */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        html, body {
            height: 100%;
            overflow: hidden;
        }
        
        body {
            background: var(--gradient-primary);
            color: var(--text-light);
            transition: background 0.5s ease;
        }
        
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
        .app-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 10px;
            max-width: 500px;
            margin: 0 auto;
        }
        
        /* –®–∞–ø–∫–∞ */
        .app-header {
            padding: 15px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            margin-bottom: 15px;
            box-shadow: var(--shadow);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
        }
        
        .logo i {
            font-size: 24px;
            color: #A78BFA;
        }
        
        .logo span {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(90deg, #FFFFFF, #E9D5FF);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* –ö–æ–Ω—Ç–µ–Ω—Ç */
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(5px);
            margin-bottom: 10px;
        }
        
        /* [–í–µ—Å—å –æ—Å—Ç–∞–ª—å–Ω–æ–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π CSS –∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–æ —Ä–∞–∑–¥–µ–ª–∞ "–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å"] */
        
        /* ============ –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨ ============ */
        
        /* –ë–µ–π–¥–∂ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ */
        .admin-badge {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--gradient-admin);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 100;
            display: none;
            align-items: center;
            gap: 5px;
            box-shadow: var(--shadow-admin);
        }
        
        .admin-badge.show {
            display: flex;
        }
        
        /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ */
        .admin-header {
            background: rgba(245, 158, 11, 0.15);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid rgba(245, 158, 11, 0.3);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .admin-header-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient-admin);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }
        
        .admin-header-title {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(90deg, #F59E0B, #FBBF24);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* –ê–¥–º–∏–Ω-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .admin-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .admin-stat-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease;
        }
        
        .admin-stat-card:hover {
            transform: translateY(-2px);
        }
        
        .admin-stat-card.warning {
            border-color: rgba(245, 158, 11, 0.3);
            background: rgba(245, 158, 11, 0.1);
        }
        
        .admin-stat-card.danger {
            border-color: rgba(239, 68, 68, 0.3);
            background: rgba(239, 68, 68, 0.1);
        }
        
        .admin-stat-card.success {
            border-color: rgba(16, 185, 129, 0.3);
            background: rgba(16, 185, 129, 0.1);
        }
        
        .admin-stat-card.info {
            border-color: rgba(59, 130, 246, 0.3);
            background: rgba(59, 130, 246, 0.1);
        }
        
        .admin-stat-number {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 5px;
        }
        
        .admin-stat-card.warning .admin-stat-number {
            color: #F59E0B;
        }
        
        .admin-stat-card.danger .admin-stat-number {
            color: #EF4444;
        }
        
        .admin-stat-card.success .admin-stat-number {
            color: #10B981;
        }
        
        .admin-stat-card.info .admin-stat-number {
            color: #3B82F6;
        }
        
        .admin-stat-label {
            font-size: 12px;
            color: #D8B4FE;
        }
        
        /* –†–∞–∑–¥–µ–ª—ã –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ */
        .admin-sections {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .admin-section-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .admin-section-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            border-radius: 13px;
            z-index: 1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .admin-section-card:hover::before {
            opacity: 1;
        }
        
        .admin-section-card:hover {
            transform: translateY(-2px);
            border-color: rgba(245, 158, 11, 0.3);
        }
        
        .admin-section-icon {
            font-size: 32px;
            color: #F59E0B;
            margin-bottom: 10px;
            position: relative;
            z-index: 2;
        }
        
        .admin-section-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
            position: relative;
            z-index: 2;
        }
        
        .admin-section-desc {
            font-size: 12px;
            color: #D8B4FE;
            position: relative;
            z-index: 2;
        }
        
        /* –ö–Ω–æ–ø–∫–∏ –±—ã—Å—Ç—Ä—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π */
        .admin-quick-actions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .admin-quick-btn {
            padding: 12px;
            border-radius: 12px;
            background: rgba(245, 158, 11, 0.2);
            border: 1px solid rgba(245, 158, 11, 0.3);
            color: #F59E0B;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .admin-quick-btn:hover {
            background: rgba(245, 158, 11, 0.3);
            transform: translateY(-2px);
        }
        
        .admin-quick-btn i {
            font-size: 16px;
        }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∏ –≤ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–∞—Ö –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ */
        .admin-subsection {
            display: none;
        }
        
        .admin-subsection.active {
            display: block;
        }
        
        .admin-list-item {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .admin-item-info h4 {
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .admin-item-info p {
            font-size: 12px;
            color: #D8B4FE;
        }
        
        .admin-item-actions {
            display: flex;
            gap: 5px;
        }
        
        .admin-item-btn {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .admin-item-btn:hover {
            transform: translateY(-2px);
        }
        
        .admin-item-btn.delete {
            background: rgba(239, 68, 68, 0.3);
            border-color: rgba(239, 68, 68, 0.5);
        }
        
        .admin-item-btn.edit {
            background: rgba(59, 130, 246, 0.3);
            border-color: rgba(59, 130, 246, 0.5);
        }
        
        .admin-item-btn.view {
            background: rgba(16, 185, 129, 0.3);
            border-color: rgba(16, 185, 129, 0.5);
        }
        
        .admin-item-btn.warning {
            background: rgba(245, 158, 11, 0.3);
            border-color: rgba(245, 158, 11, 0.5);
        }
        
        /* –§–∏–ª—å—Ç—Ä—ã –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ */
        .admin-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            overflow-x: auto;
            padding: 10px 0;
        }
        
        .admin-filter-btn {
            padding: 8px 15px;
            border-radius: 20px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .admin-filter-btn:hover {
            border-color: rgba(245, 158, 11, 0.5);
        }
        
        .admin-filter-btn.active {
            background: rgba(245, 158, 11, 0.3);
            border-color: rgba(245, 158, 11, 0.5);
        }
        
        /* –ü–∞–Ω–µ–ª—å —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
        .admin-banner-card {
            background: rgba(245, 158, 11, 0.15);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid rgba(245, 158, 11, 0.3);
        }
        
        .admin-banner-title {
            font-size: 16px;
            font-weight: 600;
            color: #F59E0B;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .banner-textarea {
            width: 100%;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 14px;
            margin-bottom: 15px;
            resize: vertical;
            min-height: 100px;
        }
        
        /* –°—Ç–∞—Ç—É—Å—ã –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ */
        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
        }
        
        .status-new {
            background: rgba(59, 130, 246, 0.3);
            color: #3B82F6;
        }
        
        .status-pending {
            background: rgba(245, 158, 11, 0.3);
            color: #F59E0B;
        }
        
        .status-resolved {
            background: rgba(16, 185, 129, 0.3);
            color: #10B981;
        }
        
        .status-rejected {
            background: rgba(239, 68, 68, 0.3);
            color: #EF4444;
        }
        
        .status-verified {
            background: rgba(139, 92, 246, 0.3);
            color: #8B5CF6;
        }
        
        .status-blocked {
            background: rgba(239, 68, 68, 0.3);
            color: #EF4444;
        }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ */
        .admin-back-btn {
            padding: 10px 20px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .admin-back-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }
        
        /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –∞–¥–º–∏–Ω–∞ */
        .admin-action-btn {
            width: 100%;
            padding: 15px;
            border-radius: 12px;
            background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .admin-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 158, 11, 0.4);
        }
        
        /* [–í–µ—Å—å –æ—Å—Ç–∞–ª—å–Ω–æ–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π CSS –∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–æ –∫–æ–Ω—Ü–∞] */
        
        /* –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
        .bottom-nav {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 10px;
            margin-top: 5px;
            box-shadow: var(--shadow);
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 5px;
            border-radius: 12px;
            background: transparent;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }
        
        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            border-radius: 10px;
            z-index: 1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .nav-item:hover::before {
            opacity: 1;
        }
        
        .nav-item.active {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.3) 0%, rgba(124, 58, 237, 0.2) 100%);
        }
        
        .nav-item:hover {
            transform: translateY(-2px);
        }
        
        .nav-icon {
            font-size: 20px;
            margin-bottom: 5px;
            position: relative;
            z-index: 2;
        }
        
        .nav-label {
            font-size: 11px;
            font-weight: 600;
            position: relative;
            z-index: 2;
        }
        
        .nav-item.admin-active {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.3) 0%, rgba(245, 158, 11, 0.2) 100%);
        }
        
        /* –°—Ç—Ä–∞–Ω–∏—Ü—ã */
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        /* [–í–µ—Å—å –æ—Å—Ç–∞–ª—å–Ω–æ–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π CSS –∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–æ –∫–æ–Ω—Ü–∞ —Ñ–∞–π–ª–∞] */
        
        /* –°–∫—Ä–æ–ª–ª–±–∞—Ä */
        ::-webkit-scrollbar {
            width: 5px;
            height: 5px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #8B5CF6;
            border-radius: 10px;
        }
        
        /* –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ */
        .hidden-file-input {
            display: none;
        }
        
        /* –ö–Ω–æ–ø–∫–∏ —Ñ–æ—Ä–º—ã */
        .form-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .publish-btn {
            flex: 2;
            padding: 15px;
            border-radius: 12px;
            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .publish-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.1) 100%);
            border-radius: 10px;
            z-index: 1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .publish-btn:hover::before {
            opacity: 1;
        }
        
        .publish-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139, 92, 246, 0.4);
        }
        
        .cancel-btn {
            flex: 1;
            padding: 15px;
            border-radius: 12px;
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.3) 0%, rgba(239, 68, 68, 0.2) 100%);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .cancel-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.1) 100%);
            border-radius: 10px;
            z-index: 1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .cancel-btn:hover::before {
            opacity: 1;
        }
        
        .cancel-btn:hover {
            transform: translateY(-2px);
        }
        
        /* –°—Ç–∏–ª—å –¥–ª—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ –ª–∞–π–∫–∞/–¥–∏–∑–ª–∞–π–∫–∞ */
        .rate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .rate-btn:disabled:hover {
            transform: none;
        }
        
        .rate-btn:disabled::before {
            display: none;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π */
        .uploaded-photos-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .uploaded-photo-item {
            width: 80px;
            height: 80px;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .uploaded-photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .remove-photo-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(239, 68, 68, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
        }
        
        /* –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å */
        .sync-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 12px;
            color: #A78BFA;
            margin-top: 10px;
        }
        
        .sync-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #10B981;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- –ë–µ–π–¥–∂ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
        <div class="admin-badge" id="adminBadge">
            <i class="fas fa-crown"></i>
            <span>–ê–¥–º–∏–Ω</span>
        </div>

        <!-- –®–∞–ø–∫–∞ -->
        <header class="app-header">
            <div class="logo">
                <i class="fas fa-smoking"></i>
                <span id="header-title">Vape Market</span>
            </div>
        </header>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <main class="main-content" id="main-content">
            <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 1: –û–±—ä—è–≤–ª–µ–Ω–∏—è -->
            <div class="page active" id="page-ads">
                <!-- [–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ–±—ä—è–≤–ª–µ–Ω–∏–π –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π] -->
                <div class="add-ad-section">
                    <div class="add-ad-header">
                        <div class="add-ad-title">–†–∞–∑–º–µ—Å—Ç–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</div>
                        <button class="toggle-form-btn" onclick="toggleAddForm()" id="addAdButton">
                            <i class="fas fa-plus-circle"></i>
                            <span id="toggle-btn-text">–î–æ–±–∞–≤–∏—Ç—å</span>
                        </button>
                    </div>
                    
                    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è -->
                    <div class="add-ad-form" id="addAdForm">
                        <!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ -->
                        <input type="file" id="photoInput" class="hidden-file-input" accept="image/*" multiple 
                               onchange="handlePhotoUpload(event)">
                        
                        <div class="photo-upload-section">
                            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ -->
                            <div class="uploaded-photos-container" id="uploaded-photos-container">
                                <!-- –§–æ—Ç–æ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                            </div>
                            
                            <button class="upload-btn" onclick="openPhotoPicker()">
                                <i class="fas fa-images"></i>
                                –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
                            </button>
                            <div class="upload-info">
                                –ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ 3 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π. –í—ã–±—Ä–∞–Ω–æ: <span id="photo-count">0</span>/3
                            </div>
                        </div>

                        <input type="text" class="form-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞" id="adTitle">
                        
                        <select class="form-input" id="adCategory">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                            <option value="liquids">–ñ–∏–¥–∫–æ—Å—Ç–∏</option>
                            <option value="disposable">–û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</option>
                            <option value="pod">–ü–æ–¥-—Å–∏—Å—Ç–µ–º—ã</option>
                            <option value="consumables">–†–∞—Å—Ö–æ–¥–Ω–∏–∫–∏</option>
                        </select>
                        
                        <input type="number" class="form-input" placeholder="–¶–µ–Ω–∞ (‚ÇΩ)" id="adPrice">
                        
                        <textarea class="form-input" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞" id="adDescription" rows="3"></textarea>
                        
                        <div class="form-buttons">
                            <button class="publish-btn" onclick="publishAd()">
                                <i class="fas fa-paper-plane"></i>
                                –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å
                            </button>
                            <button class="cancel-btn" onclick="toggleAddForm()">
                                <i class="fas fa-times"></i>
                                –û—Ç–º–µ–Ω–∞
                            </button>
                        </div>
                    </div>
                </div>

                <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
                <div class="categories">
                    <button class="category-btn active" onclick="filterCategory('all')">–í—Å–µ</button>
                    <button class="category-btn" onclick="filterCategory('liquids')">–ñ–∏–¥–∫–æ—Å—Ç–∏</button>
                    <button class="category-btn" onclick="filterCategory('disposable')">–û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ</button>
                    <button class="category-btn" onclick="filterCategory('pod')">–ü–æ–¥-—Å–∏—Å—Ç–µ–º—ã</button>
                    <button class="category-btn" onclick="filterCategory('consumables')">–†–∞—Å—Ö–æ–¥–Ω–∏–∫–∏</button>
                </div>

                <!-- –û–±—ä—è–≤–ª–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
                <div id="ads-container"></div>
                
                <!-- –°—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ -->
                <div class="sync-status" id="sync-status">
                    <div class="sync-indicator"></div>
                    <span id="sync-text">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Å Firebase</span>
                </div>
            </div>

            <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 2: –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç -->
            <div class="page" id="page-profile">
                <!-- [–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π] -->
                <div class="profile-card">
                    <div class="profile-header">
                        <div class="profile-avatar" id="profileAvatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="profile-info">
                            <h2 id="profileName">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
                            <p id="profileUsername">@username</p>
                            <div class="seller-stat stat-rating">
                                <i class="fas fa-star"></i>
                                <span id="myRating">0.0</span>
                            </div>
                        </div>
                    </div>

                    <div class="profile-stats">
                        <div class="profile-stat">
                            <div class="stat-number" id="myAdsCount">0</div>
                            <div class="stat-label">–û–±—ä—è–≤–ª–µ–Ω–∏—è</div>
                        </div>
                        <div class="profile-stat">
                            <div class="stat-number" id="myLikesCount">0</div>
                            <div class="stat-label">–õ–∞–π–∫–∏</div>
                        </div>
                        <div class="profile-stat">
                            <div class="stat-number" id="myDislikesCount">0</div>
                            <div class="stat-label">–î–∏–∑–ª–∞–π–∫–∏</div>
                        </div>
                    </div>

                    <!-- –í–∫–ª–∞–¥–∫–∏ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ -->
                    <div class="profile-tabs">
                        <div class="profile-tab active" onclick="switchProfileTab('my-ads')">
                            –ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
                        </div>
                        <div class="profile-tab" onclick="switchProfileTab('history')">
                            –ò—Å—Ç–æ—Ä–∏—è
                        </div>
                    </div>

                    <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–∫–∏ "–ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è" -->
                    <div class="profile-tab-content active" id="my-ads-tab">
                        <div class="my-ads-list" id="myAdsList">
                            <!-- –ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                        </div>
                    </div>

                    <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–∫–∏ "–ò—Å—Ç–æ—Ä–∏—è" -->
                    <div class="profile-tab-content" id="history-tab">
                        <div class="history-list" id="historyList">
                            <!-- –ò—Å—Ç–æ—Ä–∏—è –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
                        </div>
                        
                        <button class="cancel-btn" onclick="clearHistory()" style="width: 100%; margin-top: 10px;">
                            <i class="fas fa-trash"></i>
                            –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
                        </button>
                    </div>
                </div>
            </div>

            <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 3: FAQ -->
            <div class="page" id="page-faq">
                <!-- [–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç FAQ –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π] -->
                <div class="profile-card">
                    <div class="profile-header">
                        <div class="profile-avatar" style="background: var(--gradient-primary);">
                            <i class="fas fa-question-circle"></i>
                        </div>
                        <div class="profile-info">
                            <h2>–ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã</h2>
                            <p>–ü–æ–º–æ—â—å –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é</p>
                        </div>
                    </div>

                    <div class="faq-list">
                        <div class="faq-item" onclick="toggleFaq(1)">
                            <div class="faq-question">
                                <span>–ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ?</span>
                                <i class="fas fa-chevron-down" id="faq-icon-1"></i>
                            </div>
                            <div class="faq-answer" id="faq-answer-1" style="display: none;">
                                –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å" —Å–≤–µ—Ä—Ö—É. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ 3 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∏–∑ –≥–∞–ª–µ—Ä–µ–∏.
                            </div>
                        </div>
                        
                        <div class="faq-item" onclick="toggleFaq(2)">
                            <div class="faq-question">
                                <span>–ö–∞–∫ —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞?</span>
                                <i class="fas fa-chevron-down" id="faq-icon-2"></i>
                            </div>
                            <div class="faq-answer" id="faq-answer-2" style="display: none;">
                                –†–µ–π—Ç–∏–Ω–≥ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ —Ñ–æ—Ä–º—É–ª–µ: 0.1 + (–ª–∞–π–∫–∏ / (–ª–∞–π–∫–∏ + –¥–∏–∑–ª–∞–π–∫–∏)) √ó 4.9. 
                                –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –æ—Ü–µ–Ω–∫—É.
                            </div>
                        </div>
                        
                        <div class="faq-item" onclick="toggleFaq(3)">
                            <div class="faq-question">
                                <span>–ö–∞–∫ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ?</span>
                                <i class="fas fa-chevron-down" id="faq-icon-3"></i>
                            </div>
                            <div class="faq-answer" id="faq-answer-3" style="display: none;">
                                –ù–∞–∂–º–∏—Ç–µ –Ω–∞ "–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏" ‚Üí –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –≥–∞–ª–µ—Ä–µ—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞. 
                                –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –¥–æ 3 —Ñ–æ—Ç–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.
                            </div>
                        </div>
                        
                        <div class="faq-item" onclick="toggleFaq(4)">
                            <div class="faq-question">
                                <span>–ö–∞–∫ –Ω–∞–ø–∏—Å–∞—Ç—å –ø—Ä–æ–¥–∞–≤—Ü—É?</span>
                                <i class="fas fa-chevron-down" id="faq-icon-4"></i>
                            </div>
                            <div class="faq-answer" id="faq-answer-4" style="display: none;">
                                –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ù–∞–ø–∏—Å–∞—Ç—å –ø—Ä–æ–¥–∞–≤—Ü—É". –í —á–∞—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ 
                                –æ —Ç–æ–≤–∞—Ä–µ –∏ –µ–≥–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.
                            </div>
                        </div>
                        
                        <div class="faq-item" onclick="toggleFaq(5)">
                            <div class="faq-question">
                                <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞</span>
                                <i class="fas fa-chevron-down" id="faq-icon-5"></i>
                            </div>
                            <div class="faq-answer" id="faq-answer-5" style="display: none;">
                                –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É–∫–∞–∑–∞–Ω–∞ –≤ —Å–∞–º–æ–º –Ω–∏–∑—É
                            </div>
                        </div>
                        
                        <div class="faq-item" onclick="toggleFaq(6)">
                            <div class="faq-question">
                                <span>–ö–∞–∫ –æ–ø–ª–∞—á–∏–≤–∞—Ç—å —Ç–æ–≤–∞—Ä?</span>
                                <i class="fas fa-chevron-down" id="faq-icon-6"></i>
                            </div>
                            <div class="faq-answer" id="faq-answer-6" style="display: none;">
                                –í—Å–µ —Å–¥–µ–ª–∫–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –Ω–∞–ø—Ä—è–º—É—é —Å –ø—Ä–æ–¥–∞–≤—Ü–æ–º –≤ Telegram. 
                                –î–æ–≥–æ–≤–∞—Ä–∏–≤–∞–π—Ç–µ—Å—å –æ–± –æ–ø–ª–∞—Ç–µ –≤ –ª–∏—á–Ω–æ–º —á–∞—Ç–µ.
                            </div>
                        </div>
                    </div>

                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ -->
                    <div class="server-stats" id="server-stats">
                        <div class="server-stats-header">
                            <i class="fas fa-server"></i>
                            <div class="server-stats-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞</div>
                            <button class="remove-photo-btn" onclick="refreshStats()" style="position: static; margin-left: auto; background: rgba(124, 58, 237, 0.6);">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                        <div class="server-stats-grid" id="server-stats-grid">
                            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                        <div class="sync-status">
                            <div class="sync-indicator"></div>
                            <span id="server-sync-text">–û–±–Ω–æ–≤–ª–µ–Ω–æ —Ç–æ–ª—å–∫–æ —á—Ç–æ</span>
                        </div>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–¥–∞—á–∏ –∂–∞–ª–æ–±—ã -->
                    <button class="complaint-btn" onclick="submitComplaint()">
                        <i class="fas fa-exclamation-triangle"></i>
                        –ü–æ–¥–∞—Ç—å –∂–∞–ª–æ–±—É
                    </button>
                </div>
            </div>

            <!-- –°–¢–†–ê–ù–ò–¶–ê 4: –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨ -->
            <div class="page" id="page-admin">
                <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ -->
                <div class="admin-subsection active" id="admin-main">
                    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
                    <div class="admin-header">
                        <div class="admin-header-icon">
                            <i class="fas fa-crown"></i>
                        </div>
                        <div>
                            <div class="admin-header-title">üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</div>
                            <div style="font-size: 14px; color: #FBBF24;">–ü—Ä–∏–≤–µ—Ç, ìÜ©nukm0ìÜ™!</div>
                        </div>
                    </div>

                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                    <div class="admin-stats-grid">
                        <div class="admin-stat-card warning">
                            <div class="admin-stat-number" id="adminTotalUsers">0</div>
                            <div class="admin-stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                        </div>
                        <div class="admin-stat-card danger">
                            <div class="admin-stat-number" id="adminNewComplaints">0</div>
                            <div class="admin-stat-label">–ù–æ–≤—ã–µ –∂–∞–ª–æ–±—ã</div>
                        </div>
                        <div class="admin-stat-card success">
                            <div class="admin-stat-number" id="adminTotalAds">0</div>
                            <div class="admin-stat-label">–í—Å–µ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π</div>
                        </div>
                        <div class="admin-stat-card info">
                            <div class="admin-stat-number" id="adminPendingMod">0</div>
                            <div class="admin-stat-label">–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</div>
                        </div>
                    </div>

                    <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
                    <div class="admin-quick-actions">
                        <button class="admin-quick-btn" onclick="switchAdminSection('moderation')">
                            <i class="fas fa-trash"></i>
                            –£–¥–∞–ª–∏—Ç—å
                        </button>
                        <button class="admin-quick-btn" onclick="switchAdminSection('complaints')">
                            <i class="fas fa-exclamation-triangle"></i>
                            –ñ–∞–ª–æ–±—ã
                        </button>
                        <button class="admin-quick-btn" onclick="switchAdminSection('users')">
                            <i class="fas fa-user-slash"></i>
                            –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                    </div>

                    <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã -->
                    <div class="admin-sections">
                        <div class="admin-section-card" onclick="switchAdminSection('moderation')">
                            <div class="admin-section-icon">
                                <i class="fas fa-list-check"></i>
                            </div>
                            <div class="admin-section-title">–ú–æ–¥–µ—Ä–∞—Ü–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π</div>
                            <div class="admin-section-desc">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è–º–∏, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ</div>
                        </div>
                        
                        <div class="admin-section-card" onclick="switchAdminSection('users')">
                            <div class="admin-section-icon">
                                <i class="fas fa-users-cog"></i>
                            </div>
                            <div class="admin-section-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</div>
                            <div class="admin-section-desc">–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞, –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è, —Å–±—Ä–æ—Å —Ä–µ–π—Ç–∏–Ω–≥–∞</div>
                        </div>
                        
                        <div class="admin-section-card" onclick="switchAdminSection('complaints')">
                            <div class="admin-section-icon">
                                <i class="fas fa-flag"></i>
                            </div>
                            <div class="admin-section-title">–°–∏—Å—Ç–µ–º–∞ –∂–∞–ª–æ–±</div>
                            <div class="admin-section-desc">–ü—Ä–æ—Å–º–æ—Ç—Ä –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∂–∞–ª–æ–± –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                        </div>
                        
                        <div class="admin-section-card" onclick="switchAdminSection('analytics')">
                            <div class="admin-section-icon">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <div class="admin-section-title">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                            <div class="admin-section-desc">–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã</div>
                        </div>
                        
                        <div class="admin-section-card" onclick="switchAdminSection('banners')">
                            <div class="admin-section-icon">
                                <i class="fas fa-bullhorn"></i>
                            </div>
                            <div class="admin-section-title">–ë–∞–Ω–Ω–µ—Ä—ã –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</div>
                            <div class="admin-section-desc">–†–∞—Å—Å—ã–ª–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π, —Å–∏—Å—Ç–µ–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</div>
                        </div>
                        
                        <div class="admin-section-card" onclick="switchAdminSection('warnings')">
                            <div class="admin-section-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="admin-section-title">–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π</div>
                            <div class="admin-section-desc">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞, –∏—Å—Ç–æ—Ä–∏—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏</div>
                        </div>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ -->
                    <button class="admin-action-btn" onclick="loadAdminData()">
                        <i class="fas fa-sync-alt"></i>
                        –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                    </button>
                </div>

                <!-- –ü–æ–¥—Ä–∞–∑–¥–µ–ª: –ú–æ–¥–µ—Ä–∞—Ü–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π -->
                <div class="admin-subsection" id="admin-moderation">
                    <button class="admin-back-btn" onclick="switchAdminSection('main')">
                        <i class="fas fa-arrow-left"></i>
                        –ù–∞–∑–∞–¥
                    </button>
                    
                    <div class="admin-header">
                        <div class="admin-header-icon">
                            <i class="fas fa-list-check"></i>
                        </div>
                        <div>
                            <div class="admin-header-title">–ú–æ–¥–µ—Ä–∞—Ü–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π</div>
                            <div style="font-size: 14px; color: #FBBF24;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–º–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è–º–∏</div>
                        </div>
                    </div>

                    <!-- –§–∏–ª—å—Ç—Ä—ã -->
                    <div class="admin-filters">
                        <button class="admin-filter-btn active" onclick="filterAdminAds('all')">–í—Å–µ</button>
                        <button class="admin-filter-btn" onclick="filterAdminAds('new')">–ù–æ–≤—ã–µ</button>
                        <button class="admin-filter-btn" onclick="filterAdminAds('complained')">–° –∂–∞–ª–æ–±–∞–º–∏</button>
                        <button class="admin-filter-btn" onclick="filterAdminAds('unverified')">–ù–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã</button>
                        <button class="admin-filter-btn" onclick="filterAdminAds('deleted')">–£–¥–∞–ª–µ–Ω–Ω—ã–µ</button>
                    </div>

                    <!-- –°–ø–∏—Å–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ -->
                    <div id="admin-ads-list">
                        <!-- –û–±—ä—è–≤–ª–µ–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.7);">
                            <i class="fas fa-spinner fa-spin" style="font-size: 48px; margin-bottom: 20px;"></i>
                            <h3 style="margin-bottom: 10px;">–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π...</h3>
                            <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ</p>
                        </div>
                    </div>
                </div>

                <!-- –ü–æ–¥—Ä–∞–∑–¥–µ–ª: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ -->
                <div class="admin-subsection" id="admin-users">
                    <button class="admin-back-btn" onclick="switchAdminSection('main')">
                        <i class="fas fa-arrow-left"></i>
                        –ù–∞–∑–∞–¥
                    </button>
                    
                    <div class="admin-header">
                        <div class="admin-header-icon">
                            <i class="fas fa-users-cog"></i>
                        </div>
                        <div>
                            <div class="admin-header-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</div>
                            <div style="font-size: 14px; color: #FBBF24;">–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞, –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è, –∏—Å—Ç–æ—Ä–∏—è</div>
                        </div>
                    </div>

                    <!-- –§–∏–ª—å—Ç—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                    <div class="admin-filters">
                        <button class="admin-filter-btn active" onclick="filterAdminUsers('all')">–í—Å–µ</button>
                        <button class="admin-filter-btn" onclick="filterAdminUsers('active')">–ê–∫—Ç–∏–≤–Ω—ã–µ</button>
                        <button class="admin-filter-btn" onclick="filterAdminUsers('blocked')">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã</button>
                        <button class="admin-filter-btn" onclick="filterAdminUsers('verified')">–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã</button>
                        <button class="admin-filter-btn" onclick="filterAdminUsers('suspicious')">–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ</button>
                    </div>

                    <!-- –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                    <input type="text" class="form-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ ID, –∏–º–µ–Ω–∏ –∏–ª–∏ username" 
                           id="admin-users-search" onkeyup="searchAdminUsers()" style="margin-bottom: 15px;">

                    <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                    <div id="admin-users-list">
                        <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.7);">
                            <i class="fas fa-spinner fa-spin" style="font-size: 48px; margin-bottom: 20px;"></i>
                            <h3 style="margin-bottom: 10px;">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</h3>
                            <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ</p>
                        </div>
                    </div>
                </div>

                <!-- –ü–æ–¥—Ä–∞–∑–¥–µ–ª: –°–∏—Å—Ç–µ–º–∞ –∂–∞–ª–æ–± -->
                <div class="admin-subsection" id="admin-complaints">
                    <button class="admin-back-btn" onclick="switchAdminSection('main')">
                        <i class="fas fa-arrow-left"></i>
                        –ù–∞–∑–∞–¥
                    </button>
                    
                    <div class="admin-header">
                        <div class="admin-header-icon">
                            <i class="fas fa-flag"></i>
                        </div>
                        <div>
                            <div class="admin-header-title">–°–∏—Å—Ç–µ–º–∞ –∂–∞–ª–æ–±</div>
                            <div style="font-size: 14px; color: #FBBF24;">–û–±—Ä–∞–±–æ—Ç–∫–∞ –∂–∞–ª–æ–± –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                        </div>
                    </div>

                    <!-- –§–∏–ª—å—Ç—Ä—ã –∂–∞–ª–æ–± -->
                    <div class="admin-filters">
                        <button class="admin-filter-btn active" onclick="filterAdminComplaints('all')">–í—Å–µ</button>
                        <button class="admin-filter-btn" onclick="filterAdminComplaints('new')">
                            <span class="status-new">–ù–æ–≤—ã–µ</span>
                        </button>
                        <button class="admin-filter-btn" onclick="filterAdminComplaints('pending')">
                            <span class="status-pending">–í —Ä–∞–±–æ—Ç–µ</span>
                        </button>
                        <button class="admin-filter-btn" onclick="filterAdminComplaints('urgent')">
                            <span class="status-rejected">–°—Ä–æ—á–Ω–æ</span>
                        </button>
                        <button class="admin-filter-btn" onclick="filterAdminComplaints('fraud')">–ú–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ</button>
                    </div>

                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∂–∞–ª–æ–± -->
                    <div class="admin-stats-grid" style="margin-bottom: 20px;">
                        <div class="admin-stat-card info">
                            <div class="admin-stat-number" id="complaints-total">0</div>
                            <div class="admin-stat-label">–í—Å–µ–≥–æ –∂–∞–ª–æ–±</div>
                        </div>
                        <div class="admin-stat-card warning">
                            <div class="admin-stat-number" id="complaints-pending">0</div>
                            <div class="admin-stat-label">–í –æ–±—Ä–∞–±–æ—Ç–∫–µ</div>
                        </div>
                        <div class="admin-stat-card success">
                            <div class="admin-stat-number" id="complaints-resolved">0</div>
                            <div class="admin-stat-label">–†–µ—à–µ–Ω–æ</div>
                        </div>
                        <div class="admin-stat-card danger">
                            <div class="admin-stat-number" id="complaints-rejected">0</div>
                            <div class="admin-stat-label">–û—Ç–∫–ª–æ–Ω–µ–Ω–æ</div>
                        </div>
                    </div>

                    <!-- –°–ø–∏—Å–æ–∫ –∂–∞–ª–æ–± -->
                    <div id="admin-complaints-list">
                        <!-- –ñ–∞–ª–æ–±—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.7);">
                            <i class="fas fa-spinner fa-spin" style="font-size: 48px; margin-bottom: 20px;"></i>
                            <h3 style="margin-bottom: 10px;">–ó–∞–≥—Ä—É–∑–∫–∞ –∂–∞–ª–æ–±...</h3>
                            <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ</p>
                        </div>
                    </div>
                </div>

                <!-- –ü–æ–¥—Ä–∞–∑–¥–µ–ª: –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div class="admin-subsection" id="admin-analytics">
                    <button class="admin-back-btn" onclick="switchAdminSection('main')">
                        <i class="fas fa-arrow-left"></i>
                        –ù–∞–∑–∞–¥
                    </button>
                    
                    <div class="admin-header">
                        <div class="admin-header-icon">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <div>
                            <div class="admin-header-title">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                            <div style="font-size: 14px; color: #FBBF24;">–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã</div>
                        </div>
                    </div>

                    <!-- –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                    <div class="admin-stats-grid">
                        <div class="admin-stat-card warning">
                            <div class="admin-stat-number" id="analytics-total-users">0</div>
                            <div class="admin-stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                        </div>
                        <div class="admin-stat-card info">
                            <div class="admin-stat-number" id="analytics-new-today">0</div>
                            <div class="admin-stat-label">–ù–æ–≤—ã—Ö —Å–µ–≥–æ–¥–Ω—è</div>
                        </div>
                        <div class="admin-stat-card success">
                            <div class="admin-stat-number" id="analytics-total-ads">0</div>
                            <div class="admin-stat-label">–í—Å–µ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π</div>
                        </div>
                        <div class="admin-stat-card warning">
                            <div class="admin-stat-number" id="analytics-published-today">0</div>
                            <div class="admin-stat-label">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ —Å–µ–≥–æ–¥–Ω—è</div>
                        </div>
                    </div>

                    <!-- –†–µ–π—Ç–∏–Ω–≥–∏ -->
                    <div class="admin-stat-card" style="margin-bottom: 15px;">
                        <div class="admin-stat-number" id="analytics-avg-rating">0.0</div>
                        <div class="admin-stat-label">–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã</div>
                    </div>

                    <!-- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º -->
                    <div style="margin-bottom: 20px;">
                        <h3 style="font-size: 16px; margin-bottom: 10px; color: #F59E0B;">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤</h3>
                        <div id="analytics-categories">
                            <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ -->
                    <button class="admin-action-btn" onclick="exportAnalytics()">
                        <i class="fas fa-download"></i>
                        –≠–∫—Å–ø–æ—Ä—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                    </button>
                </div>

                <!-- –ü–æ–¥—Ä–∞–∑–¥–µ–ª: –ë–∞–Ω–Ω–µ—Ä—ã –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
                <div class="admin-subsection" id="admin-banners">
                    <button class="admin-back-btn" onclick="switchAdminSection('main')">
                        <i class="fas fa-arrow-left"></i>
                        –ù–∞–∑–∞–¥
                    </button>
                    
                    <div class="admin-header">
                        <div class="admin-header-icon">
                            <i class="fas fa-bullhorn"></i>
                        </div>
                        <div>
                            <div class="admin-header-title">–ë–∞–Ω–Ω–µ—Ä—ã –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</div>
                            <div style="font-size: 14px; color: #FBBF24;">–†–∞—Å—Å—ã–ª–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º</div>
                        </div>
                    </div>

                    <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
                    <div class="admin-banner-card">
                        <div class="admin-banner-title">
                            <i class="fas fa-bullhorn"></i>
                            –°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                        </div>
                        
                        <input type="text" class="form-input" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è" id="banner-title">
                        
                        <textarea class="banner-textarea" placeholder="–¢–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π..." id="banner-text"></textarea>
                        
                        <select class="form-input" id="banner-type">
                            <option value="info">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</option>
                            <option value="warning">‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ</option>
                            <option value="success">‚úÖ –£—Å–ø–µ—Ö</option>
                            <option value="error">‚ùå –û—à–∏–±–∫–∞</option>
                        </select>
                        
                        <select class="form-input" id="banner-duration">
                            <option value="1">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å 1 —á–∞—Å</option>
                            <option value="24">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å 24 —á–∞—Å–∞</option>
                            <option value="168">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–µ–¥–µ–ª—é</option>
                            <option value="permanent">–ü–æ—Å—Ç–æ—è–Ω–Ω–æ</option>
                        </select>

                        <div class="form-buttons" style="margin-top: 15px;">
                            <button class="publish-btn" onclick="sendBannerToAll()">
                                <i class="fas fa-paper-plane"></i>
                                –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ–º
                            </button>
                            <button class="cancel-btn" onclick="clearBannerForm()">
                                <i class="fas fa-times"></i>
                                –û—á–∏—Å—Ç–∏—Ç—å
                            </button>
                        </div>
                    </div>

                    <!-- –ò—Å—Ç–æ—Ä–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
                    <h3 style="font-size: 16px; margin-bottom: 10px; color: #F59E0B;">–ò—Å—Ç–æ—Ä–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</h3>
                    <div id="admin-banners-history">
                        <!-- –ò—Å—Ç–æ—Ä–∏—è –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        <div style="text-align: center; padding: 20px; color: rgba(255,255,255,0.7);">
                            <i class="fas fa-history"></i>
                            <p>–ò—Å—Ç–æ—Ä–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—É—Å—Ç–∞</p>
                        </div>
                    </div>
                </div>

                <!-- –ü–æ–¥—Ä–∞–∑–¥–µ–ª: –°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π -->
                <div class="admin-subsection" id="admin-warnings">
                    <button class="admin-back-btn" onclick="switchAdminSection('main')">
                        <i class="fas fa-arrow-left"></i>
                        –ù–∞–∑–∞–¥
                    </button>
                    
                    <div class="admin-header">
                        <div class="admin-header-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div>
                            <div class="admin-header-title">–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π</div>
                            <div style="font-size: 14px; color: #FBBF24;">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –∏ –∏—Å—Ç–æ—Ä–∏—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏</div>
                        </div>
                    </div>

                    <!-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ -->
                    <div class="admin-banner-card">
                        <div class="admin-banner-title">
                            <i class="fas fa-robot"></i>
                            –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞
                        </div>
                        
                        <div class="admin-list-item">
                            <div class="admin-item-info">
                                <h4>3 –∂–∞–ª–æ–±—ã = –≤—Ä–µ–º–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞</h4>
                                <p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –Ω–∞ 24 —á–∞—Å–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ 3 –∂–∞–ª–æ–±</p>
                            </div>
                            <div class="admin-item-actions">
                                <button class="admin-item-btn edit" onclick="editRule(1)">–ò–∑–º–µ–Ω–∏—Ç—å</button>
                            </div>
                        </div>
                        
                        <div class="admin-list-item">
                            <div class="admin-item-info">
                                <h4>–ù–∏–∑–∫–∏–π —Ä–µ–π—Ç–∏–Ω–≥ = –ø—Ä–æ–≤–µ—Ä–∫–∞</h4>
                                <p>–†–µ–π—Ç–∏–Ω–≥ –Ω–∏–∂–µ 2.0 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é</p>
                            </div>
                            <div class="admin-item-actions">
                                <button class="admin-item-btn edit" onclick="editRule(2)">–ò–∑–º–µ–Ω–∏—Ç—å</button>
                            </div>
                        </div>
                    </div>

                    <!-- –®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π -->
                    <h3 style="font-size: 16px; margin-bottom: 10px; color: #F59E0B; margin-top: 20px;">–®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π</h3>
                    <div id="admin-templates">
                        <div class="admin-list-item">
                            <div class="admin-item-info">
                                <h4>–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑–∞ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ</h4>
                                <p>–í–∞—à –∞–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∑–∞ –ø–æ–ø—ã—Ç–∫—É –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞...</p>
                            </div>
                            <div class="admin-item-actions">
                                <button class="admin-item-btn view" onclick="useTemplate(1)">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</button>
                            </div>
                        </div>
                        
                        <div class="admin-list-item">
                            <div class="admin-item-info">
                                <h4>–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∑–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–µ</h4>
                                <p>–í—ã –ø–æ–ª—É—á–∏–ª–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∑–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª...</p>
                            </div>
                            <div class="admin-item-actions">
                                <button class="admin-item-btn view" onclick="useTemplate(2)">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</button>
                            </div>
                        </div>
                    </div>

                    <!-- –ò—Å—Ç–æ—Ä–∏—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ -->
                    <h3 style="font-size: 16px; margin-bottom: 10px; color: #F59E0B; margin-top: 20px;">–ò—Å—Ç–æ—Ä–∏—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏</h3>
                    <div id="admin-moderation-history">
                        <!-- –ò—Å—Ç–æ—Ä–∏—è –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        <div style="text-align: center; padding: 20px; color: rgba(255,255,255,0.7);">
                            <i class="fas fa-history"></i>
                            <p>–ò—Å—Ç–æ—Ä–∏—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –ø—É—Å—Ç–∞</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-page="ads" onclick="switchPage('ads')">
                <div class="nav-icon">
                    <i class="fas fa-box-open"></i>
                </div>
                <span class="nav-label">–û–±—ä—è–≤–ª–µ–Ω–∏—è</span>
            </button>
            
            <button class="nav-item" data-page="profile" onclick="switchPage('profile')">
                <div class="nav-icon">
                    <i class="fas fa-user-circle"></i>
                </div>
                <span class="nav-label">–ö–∞–±–∏–Ω–µ—Ç</span>
            </button>
            
            <button class="nav-item" data-page="faq" onclick="switchPage('faq')">
                <div class="nav-icon">
                    <i class="fas fa-question-circle"></i>
                </div>
                <span class="nav-label">FAQ</span>
            </button>
            
            <button class="nav-item" data-page="admin" onclick="switchPage('admin')" id="admin-nav-item" style="display: none;">
                <div class="nav-icon">
                    <i class="fas fa-crown"></i>
                </div>
                <span class="nav-label">–ê–¥–º–∏–Ω</span>
            </button>
        </nav>

        <!-- [–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π] -->
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–æ—Ç–æ -->
        <div class="photo-modal" id="photoModal">
            <button class="photo-modal-close" onclick="closePhotoModal()">
                <i class="fas fa-times"></i>
            </button>
            <div class="photo-modal-nav">
                <button class="photo-modal-nav-btn" onclick="prevPhoto()">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button class="photo-modal-nav-btn" onclick="nextPhoto()">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <img class="photo-modal-img" id="modalPhoto" src="" alt="–ü—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ—Ç–æ">
            <div class="photo-modal-counter" id="photoCounter">1 / 1</div>
        </div>

        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
        <div class="notification" id="notification"></div>
    </div>

    <script>
        // ==================== FIREBASE –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ====================
        const firebaseConfig = {
            apiKey: "AIzaSyBgPG4EXFQHoIOVLt2_BdCmiUJEWTXsGN8",
            authDomain: "telegram-market-vape.firebaseapp.com",
            databaseURL: "https://telegram-market-vape-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "telegram-market-vape",
            storageBucket: "telegram-market-vape.appspot.com",
            messagingSenderId: "35870048384",
            appId: "1:35870048384:web:acd6501459aa39180b6665",
            measurementId: "G-99R2PPBNF8"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        // ==================== –ö–û–ù–ï–¶ FIREBASE ====================

        // ==================== FIREBASE –°–ï–†–í–ï–† ====================
        const FirebaseMarketServer = {
            // [–í–µ—Å—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ FirebaseMarketServer –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π]
            // –î–æ–±–∞–≤–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
            addAd: async function(adData) {
                try {
                    console.log('üîÑ –î–æ–±–∞–≤–ª—è—é –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –≤ Firebase...');
                    
                    // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    await this.registerUser({
                        id: adData.sellerId,
                        name: adData.sellerName,
                        username: adData.sellerUsername
                    });
                    
                    // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å —Ñ–æ—Ç–æ
                    const adToSave = {
                        sellerId: adData.sellerId,
                        sellerName: adData.sellerName,
                        sellerUsername: adData.sellerUsername,
                        sellerAvatar: adData.sellerAvatar || null,
                        title: adData.title,
                        category: adData.category,
                        price: Number(adData.price),
                        description: adData.description || '',
                        photoUrls: adData.photoUrls || [], // –¢–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–æ—Ç–æ
                        photos: adData.photoUrls?.length || 0,
                        likes: 0,
                        dislikes: 0,
                        createdAt: firebase.database.ServerValue.TIMESTAMP,
                        updatedAt: firebase.database.ServerValue.TIMESTAMP,
                        verified: false, // –ù–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π
                        complaints: 0, // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–∞–ª–æ–±
                        status: 'active' // –°—Ç–∞—Ç—É—Å: active, pending, deleted
                    };
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –≤ –±–∞–∑—É
                    const newAdRef = database.ref('ads').push();
                    const adId = newAdRef.key;
                    
                    await newAdRef.set(adToSave);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    await database.ref(`users/${adData.sellerId}/adsCount`).transaction((current) => {
                        return (current || 0) + 1;
                    });
                    
                    console.log('‚úÖ –û–±—ä—è–≤–ª–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ, ID:', adId);
                    return adId;
                    
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:', error);
                    throw error;
                }
            },
            
            // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
            getAllAds: async function() {
                try {
                    const snapshot = await database.ref('ads').once('value');
                    const ads = [];
                    
                    snapshot.forEach((childSnapshot) => {
                        const ad = childSnapshot.val();
                        ad.id = childSnapshot.key;
                        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º photoUrls –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
                        if (!ad.photoUrls && ad.photos > 0) {
                            ad.photoUrls = [];
                            for (let i = 0; i < ad.photos; i++) {
                                ad.photoUrls.push(null); // –ó–∞–≥–ª—É—à–∫–∏
                            }
                        }
                        ads.push(ad);
                    });
                    
                    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–Ω–∞—á–∞–ª–∞)
                    ads.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
                    
                    return ads;
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–π:', error);
                    return [];
                }
            },
            
            // –°–ª—É—à–∞—Ç—å –Ω–æ–≤—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
            listenToAds: function(callback) {
                database.ref('ads').on('value', (snapshot) => {
                    const ads = [];
                    snapshot.forEach((childSnapshot) => {
                        const ad = childSnapshot.val();
                        ad.id = childSnapshot.key;
                        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º photoUrls –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
                        if (!ad.photoUrls && ad.photos > 0) {
                            ad.photoUrls = [];
                            for (let i = 0; i < ad.photos; i++) {
                                ad.photoUrls.push(null);
                            }
                        }
                        ads.push(ad);
                    });
                    
                    // –°–æ—Ä—Ç–∏—Ä—É–µ–º
                    ads.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
                    callback(ads);
                });
            },
            
            // –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–π—Ç–∏–Ω–≥–∏
            getRatings: async function() {
                try {
                    const snapshot = await database.ref('ratings').once('value');
                    return snapshot.val() || {};
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤:', error);
                    return {};
                }
            },
            
            // –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–π—Ç–∏–Ω–≥
            updateRating: async function(sellerId, userId, rating) {
                try {
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ü–µ–Ω–∫—É
                    await database.ref(`ratings/${sellerId}/${userId}`).set(rating);
                    
                    // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –æ—Ü–µ–Ω–∫–∏
                    const ratingsSnapshot = await database.ref(`ratings/${sellerId}`).once('value');
                    const ratings = ratingsSnapshot.val() || {};
                    
                    // –°—á–∏—Ç–∞–µ–º –ª–∞–π–∫–∏/–¥–∏–∑–ª–∞–π–∫–∏
                    let likes = 0, dislikes = 0;
                    Object.values(ratings).forEach(r => {
                        if (r === 'like') likes++;
                        if (r === 'dislike') dislikes++;
                    });
                    
                    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–µ–π—Ç–∏–Ω–≥
                    const total = likes + dislikes;
                    const calculatedRating = total > 0 ? 0.1 + (likes / total) * 4.9 : 0.1;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    await database.ref(`users/${sellerId}`).update({
                        likesCount: likes,
                        dislikesCount: dislikes,
                        rating: calculatedRating,
                        lastActive: firebase.database.ServerValue.TIMESTAMP
                    });
                    
                    return true;
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞:', error);
                    return false;
                }
            },
            
            // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            registerUser: async function(userData) {
                try {
                    const userRef = database.ref(`users/${userData.id}`);
                    const snapshot = await userRef.once('value');
                    
                    if (!snapshot.exists()) {
                        await userRef.set({
                            id: userData.id,
                            name: userData.name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                            username: userData.username || '',
                            registrationDate: firebase.database.ServerValue.TIMESTAMP,
                            lastActive: firebase.database.ServerValue.TIMESTAMP,
                            adsCount: 0,
                            likesCount: 0,
                            dislikesCount: 0,
                            rating: 0.1,
                            verified: false, // –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω –ª–∏ –ø—Ä–æ–¥–∞–≤–µ—Ü
                            blocked: false, // –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                            warnings: 0, // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
                            complaintsCount: 0 // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–∞–ª–æ–± –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        });
                        console.log('‚úÖ –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω');
                    } else {
                        await userRef.update({
                            lastActive: firebase.database.ServerValue.TIMESTAMP
                        });
                    }
                    
                    return true;
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:', error);
                    return false;
                }
            },
            
            // –î–æ–±–∞–≤–∏—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏—é
            addToHistory: async function(userId, historyItem) {
                try {
                    const historyRef = database.ref(`userHistory/${userId}`).push();
                    await historyRef.set({
                        ...historyItem,
                        id: historyRef.key,
                        timestamp: new Date().toISOString()
                    });
                    
                    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é 50 –∑–∞–ø–∏—Å—è–º–∏
                    const historySnapshot = await database.ref(`userHistory/${userId}`).once('value');
                    const history = [];
                    historySnapshot.forEach((child) => {
                        history.push({ key: child.key, ...child.val() });
                    });
                    
                    if (history.length > 50) {
                        const toDelete = history.slice(50);
                        for (const item of toDelete) {
                            await database.ref(`userHistory/${userId}/${item.key}`).remove();
                        }
                    }
                    
                    return true;
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏:', error);
                    return false;
                }
            },
            
            // –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            getUserHistory: async function(userId) {
                try {
                    const snapshot = await database.ref(`userHistory/${userId}`).once('value');
                    const history = [];
                    snapshot.forEach((childSnapshot) => {
                        history.unshift(childSnapshot.val());
                    });
                    return history;
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏:', error);
                    return [];
                }
            },
            
            // –£–¥–∞–ª–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
            deleteAd: async function(adId, sellerId) {
                try {
                    await database.ref(`ads/${adId}`).remove();
                    
                    // –£–º–µ–Ω—å—à–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    await database.ref(`users/${sellerId}/adsCount`).transaction((current) => {
                        return Math.max(0, (current || 1) - 1);
                    });
                    
                    return true;
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è:', error);
                    return false;
                }
            },
            
            // –û–±–Ω–æ–≤–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
            updateAd: async function(adId, adData) {
                try {
                    await database.ref(`ads/${adId}`).update(adData);
                    return true;
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è:', error);
                    return false;
                }
            },
            
            // –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            getStats: async function() {
                try {
                    // –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π
                    const adsSnapshot = await database.ref('ads').once('value');
                    const totalAds = adsSnapshot.numChildren();
                    
                    // –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                    const usersSnapshot = await database.ref('users').once('value');
                    const totalUsers = usersSnapshot.numChildren();
                    
                    // –°—á–∏—Ç–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    let todayAds = 0;
                    
                    adsSnapshot.forEach((childSnapshot) => {
                        const ad = childSnapshot.val();
                        if (ad.createdAt && new Date(ad.createdAt) >= today) {
                            todayAds++;
                        }
                    });
                    
                    // –°—á–∏—Ç–∞–µ–º –ª–∞–π–∫–∏ –∏ –¥–∏–∑–ª–∞–π–∫–∏
                    const ratingsSnapshot = await database.ref('ratings').once('value');
                    let totalLikes = 0;
                    let totalDislikes = 0;
                    
                    ratingsSnapshot.forEach((userSnapshot) => {
                        userSnapshot.forEach((ratingSnapshot) => {
                            if (ratingSnapshot.val() === 'like') totalLikes++;
                            if (ratingSnapshot.val() === 'dislike') totalDislikes++;
                        });
                    });
                    
                    // –°—á–∏—Ç–∞–µ–º –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
                    const categories = { liquids: 0, disposable: 0, pod: 0, consumables: 0, other: 0 };
                    adsSnapshot.forEach((childSnapshot) => {
                        const ad = childSnapshot.val();
                        const category = ad.category || 'other';
                        if (categories[category] !== undefined) {
                            categories[category]++;
                        } else {
                            categories.other++;
                        }
                    });
                    
                    // –°—á–∏—Ç–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π)
                    const weekAgo = new Date();
                    weekAgo.setDate(weekAgo.getDate() - 7);
                    let activeUsers = 0;
                    
                    usersSnapshot.forEach((childSnapshot) => {
                        const user = childSnapshot.val();
                        if (user.lastActive && new Date(user.lastActive) > weekAgo) {
                            activeUsers++;
                        }
                    });
                    
                    return {
                        totalUsers: totalUsers,
                        activeUsers: activeUsers,
                        totalAds: totalAds,
                        todayAds: todayAds,
                        totalLikes: totalLikes,
                        totalDislikes: totalDislikes,
                        categories: categories,
                        lastUpdated: new Date().toISOString(),
                        serverStatus: 'online'
                    };
                    
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
                    return {
                        totalUsers: 0,
                        activeUsers: 0,
                        totalAds: 0,
                        todayAds: 0,
                        totalLikes: 0,
                        totalDislikes: 0,
                        categories: { liquids: 0, disposable: 0, pod: 0, consumables: 0, other: 0 },
                        lastUpdated: new Date().toISOString(),
                        serverStatus: 'offline'
                    };
                }
            },
            
            // –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            clearUserHistory: async function(userId) {
                try {
                    await database.ref(`userHistory/${userId}`).remove();
                    return true;
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏:', error);
                    return false;
                }
            },
            
            // ==================== –ê–î–ú–ò–ù-–ú–ï–¢–û–î–´ ====================
            
            // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
            getAdminData: async function() {
                try {
                    const [adsSnapshot, usersSnapshot, ratingsSnapshot] = await Promise.all([
                        database.ref('ads').once('value'),
                        database.ref('users').once('value'),
                        database.ref('ratings').once('value')
                    ]);
                    
                    const ads = [];
                    adsSnapshot.forEach((child) => {
                        const ad = child.val();
                        ad.id = child.key;
                        ads.push(ad);
                    });
                    
                    const users = [];
                    usersSnapshot.forEach((child) => {
                        const user = child.val();
                        user.id = child.key;
                        users.push(user);
                    });
                    
                    return {
                        ads: ads,
                        users: users,
                        totalUsers: usersSnapshot.numChildren(),
                        totalAds: adsSnapshot.numChildren()
                    };
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–¥–º–∏–Ω-–¥–∞–Ω–Ω—ã—Ö:', error);
                    return { ads: [], users: [], totalUsers: 0, totalAds: 0 };
                }
            },
            
            // –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            blockUser: async function(userId, reason, duration) {
                try {
                    await database.ref(`users/${userId}`).update({
                        blocked: true,
                        blockReason: reason,
                        blockedUntil: duration === 'permanent' ? 'permanent' : 
                                    Date.now() + (duration * 60 * 60 * 1000)
                    });
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é –º–æ–¥–µ—Ä–∞—Ü–∏–∏
                    await database.ref('moderationHistory').push().set({
                        action: 'block',
                        userId: userId,
                        adminId: appData.currentUserId,
                        reason: reason,
                        duration: duration,
                        timestamp: firebase.database.ServerValue.TIMESTAMP
                    });
                    
                    return true;
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                    return false;
                }
            },
            
            // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            unblockUser: async function(userId) {
                try {
                    await database.ref(`users/${userId}`).update({
                        blocked: false,
                        blockReason: null,
                        blockedUntil: null
                    });
                    
                    await database.ref('moderationHistory').push().set({
                        action: 'unblock',
                        userId: userId,
                        adminId: appData.currentUserId,
                        timestamp: firebase.database.ServerValue.TIMESTAMP
                    });
                    
                    return true;
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                    return false;
                }
            },
            
            // –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            verifyUser: async function(userId) {
                try {
                    await database.ref(`users/${userId}`).update({
                        verified: true
                    });
                    
                    await database.ref('moderationHistory').push().set({
                        action: 'verify',
                        userId: userId,
                        adminId: appData.currentUserId,
                        timestamp: firebase.database.ServerValue.TIMESTAMP
                    });
                    
                    return true;
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                    return false;
                }
            },
            
            // –î–æ–±–∞–≤–∏—Ç—å –∂–∞–ª–æ–±—É
            addComplaint: async function(complaintData) {
                try {
                    const complaintRef = database.ref('complaints').push();
                    await complaintRef.set({
                        ...complaintData,
                        id: complaintRef.key,
                        status: 'new',
                        createdAt: firebase.database.ServerValue.TIMESTAMP
                    });
                    
                    return complaintRef.key;
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∂–∞–ª–æ–±—ã:', error);
                    return null;
                }
            },
            
            // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∂–∞–ª–æ–±—ã
            getComplaints: async function() {
                try {
                    const snapshot = await database.ref('complaints').once('value');
                    const complaints = [];
                    snapshot.forEach((child) => {
                        complaints.push(child.val());
                    });
                    return complaints;
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∂–∞–ª–æ–±:', error);
                    return [];
                }
            },
            
            // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∂–∞–ª–æ–±—ã
            updateComplaintStatus: async function(complaintId, status, adminNote = '') {
                try {
                    await database.ref(`complaints/${complaintId}`).update({
                        status: status,
                        adminNote: adminNote,
                        resolvedAt: firebase.database.ServerValue.TIMESTAMP
                    });
                    
                    return true;
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∂–∞–ª–æ–±—ã:', error);
                    return false;
                }
            },
            
            // –°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            createSystemNotification: async function(notificationData) {
                try {
                    const notificationRef = database.ref('systemNotifications').push();
                    await notificationRef.set({
                        ...notificationData,
                        id: notificationRef.key,
                        createdAt: firebase.database.ServerValue.TIMESTAMP
                    });
                    
                    return notificationRef.key;
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:', error);
                    return null;
                }
            },
            
            // –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –º–æ–¥–µ—Ä–∞—Ü–∏–∏
            getModerationHistory: async function() {
                try {
                    const snapshot = await database.ref('moderationHistory').once('value');
                    const history = [];
                    snapshot.forEach((child) => {
                        history.unshift(child.val());
                    });
                    return history;
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏:', error);
                    return [];
                }
            }
        };
        // ==================== –ö–û–ù–ï–¶ FIREBASE –°–ï–†–í–ï–†–ê ====================
        
        // ==================== –û–°–ù–û–í–ù–û–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–ï ====================
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram?.WebApp;
        
        // –°–∏—Å—Ç–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        const appData = {
            currentUserId: null,
            currentUserData: null,
            ads: [],
            userRatings: {},
            history: [],
            uploadedPhotos: [],
            currentPhotoIndex: 0,
            currentPhotoList: [],
            currentCategory: 'all',
            editingAdId: null,
            serverStats: null,
            lastSyncTime: null,
            isDataLoaded: false,
            isAdmin: false, // –ù–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞
            adminData: {
                users: [],
                complaints: [],
                moderationHistory: [],
                stats: {}
            },
            currentAdminSection: 'main',
            currentAdminFilter: 'all'
        };
        
        // –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã —Å–∏—Å—Ç–µ–º—ã
        const ADMIN_USERS = {
            '998579758': { // ID @nukm0
                id: '998579758',
                username: 'nukm0',
                name: 'ìÜ©nukm0ìÜ™',
                role: 'superadmin'
            }
            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏—Ö –∞–¥–º–∏–Ω–æ–≤ –∑–¥–µ—Å—å
        };
        
        function checkTelegramAndInit() {
            console.log('üîç –ù–∞—á–∏–Ω–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é...');
            
            // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å Telegram Web App
            const tg = window.Telegram?.WebApp;
            
            if (tg) {
                console.log('‚úÖ Telegram Web App –æ–±–Ω–∞—Ä—É–∂–µ–Ω');
                
                // –†–∞—Å—à–∏—Ä—è–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
                tg.expand();
                tg.ready();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
                tg.BackButton.show();
                tg.BackButton.onClick(function() {
                    tg.close();
                });
                
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const user = tg.initDataUnsafe?.user;
                console.log('–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram:', user);
                
                if (user && user.id) {
                    console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å Telegram –ø–æ–ª—É—á–µ–Ω');
                    appData.currentUserId = user.id.toString();
                    appData.currentUserData = {
                        id: user.id,
                        first_name: user.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                        last_name: user.last_name || '',
                        username: user.username || '',
                        photo_url: user.photo_url || null
                    };
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
                    if (ADMIN_USERS[appData.currentUserId]) {
                        appData.isAdmin = true;
                        document.getElementById('admin-nav-item').style.display = 'flex';
                        document.getElementById('adminBadge').classList.add('show');
                        console.log('üëë –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º');
                    }
                    
                    // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –≤ Firebase –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                    FirebaseMarketServer.registerUser(appData.currentUserData)
                        .then(success => {
                            console.log('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Firebase:', success ? '‚úÖ –£—Å–ø–µ—à–Ω–æ' : '‚ùå –û—à–∏–±–∫–∞');
                            initApp();
                        })
                        .catch(error => {
                            console.error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ Firebase:', error);
                            initApp();
                        });
                } else {
                    console.warn('‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram');
                    createTestUser();
                }
            } else {
                console.warn('‚ö†Ô∏è Telegram Web App –Ω–µ –Ω–∞–π–¥–µ–Ω (–æ—Ç–∫—Ä—ã—Ç–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ)');
                createTestUser();
            }
            
            function createTestUser() {
                appData.currentUserId = 'test_user_' + Date.now();
                appData.currentUserData = {
                    id: appData.currentUserId,
                    first_name: '–¢–µ—Å—Ç–æ–≤—ã–π',
                    username: 'testuser_' + Math.floor(Math.random() * 1000),
                    photo_url: null
                };
                
                console.log('üîÑ –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', appData.currentUserData);
                
                FirebaseMarketServer.registerUser(appData.currentUserData)
                    .then(success => {
                        console.log('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', success ? '‚úÖ –£—Å–ø–µ—à–Ω–æ' : '‚ùå –û—à–∏–±–∫–∞');
                        initApp();
                    })
                    .catch(error => {
                        console.error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                        initApp();
                    });
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å Firebase
        async function loadFromServer() {
            try {
                console.log('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å Firebase...');
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–∏—è
                appData.ads = await FirebaseMarketServer.getAllAds();
                console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${appData.ads.length} –æ–±—ä—è–≤–ª–µ–Ω–∏–π –∏–∑ Firebase`);
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–π—Ç–∏–Ω–≥–∏
                appData.userRatings = await FirebaseMarketServer.getRatings();
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
                if (appData.currentUserId) {
                    appData.history = await FirebaseMarketServer.getUserHistory(appData.currentUserId);
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                appData.serverStats = await FirebaseMarketServer.getStats();
                
                // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω - –∑–∞–≥—Ä—É–∂–∞–µ–º –∞–¥–º–∏–Ω-–¥–∞–Ω–Ω—ã–µ
                if (appData.isAdmin) {
                    await loadAdminData();
                }
                
                appData.lastSyncTime = new Date();
                appData.isDataLoaded = true;
                
                updateSyncStatus();
                updateUIAfterDataLoad();
                
                showNotification(`–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã (${appData.ads.length} –æ–±—ä—è–≤–ª–µ–Ω–∏–π)`, 'success');
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', 'warning');
                
                appData.isDataLoaded = true;
                appData.ads = [];
                updateUIAfterDataLoad();
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
        async function loadAdminData() {
            if (!appData.isAdmin) return;
            
            try {
                console.log('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –∞–¥–º–∏–Ω-–¥–∞–Ω–Ω—ã—Ö...');
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                const usersSnapshot = await database.ref('users').once('value');
                appData.adminData.users = [];
                usersSnapshot.forEach((child) => {
                    const user = child.val();
                    user.id = child.key;
                    appData.adminData.users.push(user);
                });
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∂–∞–ª–æ–±—ã
                const complaintsSnapshot = await database.ref('complaints').once('value');
                appData.adminData.complaints = [];
                complaintsSnapshot.forEach((child) => {
                    const complaint = child.val();
                    complaint.id = child.key;
                    appData.adminData.complaints.push(complaint);
                });
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –º–æ–¥–µ—Ä–∞—Ü–∏–∏
                appData.adminData.moderationHistory = await FirebaseMarketServer.getModerationHistory();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                updateAdminStats();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π —Ä–∞–∑–¥–µ–ª –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
                updateCurrentAdminSection();
                
                showNotification('–ê–¥–º–∏–Ω-–¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–¥–º–∏–Ω-–¥–∞–Ω–Ω—ã—Ö:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–¥–º–∏–Ω-–¥–∞–Ω–Ω—ã—Ö', 'error');
            }
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
        function updateAdminStats() {
            if (!appData.isAdmin || !appData.adminData.users) return;
            
            // –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            document.getElementById('adminTotalUsers').textContent = appData.adminData.users.length;
            document.getElementById('adminTotalAds').textContent = appData.ads.length;
            
            // –ù–æ–≤—ã–µ –∂–∞–ª–æ–±—ã
            const newComplaints = appData.adminData.complaints.filter(c => c.status === 'new').length;
            document.getElementById('adminNewComplaints').textContent = newComplaints;
            
            // –û–±—ä—è–≤–ª–µ–Ω–∏—è –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
            const pendingAds = appData.ads.filter(ad => !ad.verified && ad.status === 'active').length;
            document.getElementById('adminPendingMod').textContent = pendingAds;
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∂–∞–ª–æ–±
            const totalComplaints = appData.adminData.complaints.length;
            const pendingComplaints = appData.adminData.complaints.filter(c => c.status === 'pending').length;
            const resolvedComplaints = appData.adminData.complaints.filter(c => c.status === 'resolved').length;
            const rejectedComplaints = appData.adminData.complaints.filter(c => c.status === 'rejected').length;
            
            document.getElementById('complaints-total').textContent = totalComplaints;
            document.getElementById('complaints-pending').textContent = pendingComplaints;
            document.getElementById('complaints-resolved').textContent = resolvedComplaints;
            document.getElementById('complaints-rejected').textContent = rejectedComplaints;
            
            // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const newUsersToday = appData.adminData.users.filter(user => 
                user.registrationDate && new Date(user.registrationDate) >= today
            ).length;
            
            const publishedToday = appData.ads.filter(ad => 
                ad.createdAt && new Date(ad.createdAt) >= today
            ).length;
            
            // –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥
            const totalRating = appData.adminData.users.reduce((sum, user) => sum + (user.rating || 0.1), 0);
            const avgRating = appData.adminData.users.length > 0 ? 
                (totalRating / appData.adminData.users.length).toFixed(1) : '0.0';
            
            document.getElementById('analytics-total-users').textContent = appData.adminData.users.length;
            document.getElementById('analytics-new-today').textContent = newUsersToday;
            document.getElementById('analytics-total-ads').textContent = appData.ads.length;
            document.getElementById('analytics-published-today').textContent = publishedToday;
            document.getElementById('analytics-avg-rating').textContent = avgRating;
            
            // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
            updateCategoriesAnalytics();
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
        function updateCategoriesAnalytics() {
            const categoriesContainer = document.getElementById('analytics-categories');
            if (!categoriesContainer) return;
            
            const categories = { liquids: 0, disposable: 0, pod: 0, consumables: 0, other: 0 };
            
            appData.ads.forEach(ad => {
                const category = ad.category || 'other';
                if (categories[category] !== undefined) {
                    categories[category]++;
                } else {
                    categories.other++;
                }
            });
            
            categoriesContainer.innerHTML = `
                <div style="margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span style="font-size: 12px;">–ñ–∏–¥–∫–æ—Å—Ç–∏</span>
                        <span style="font-size: 12px; color: #F59E0B;">${categories.liquids}</span>
                    </div>
                    <div style="height: 5px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden;">
                        <div style="width: ${(categories.liquids / Math.max(...Object.values(categories))) * 100}%; height: 100%; background: #8B5CF6;"></div>
                    </div>
                </div>
                
                <div style="margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span style="font-size: 12px;">–û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ</span>
                        <span style="font-size: 12px; color: #F59E0B;">${categories.disposable}</span>
                    </div>
                    <div style="height: 5px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden;">
                        <div style="width: ${(categories.disposable / Math.max(...Object.values(categories))) * 100}%; height: 100%; background: #7C3AED;"></div>
                    </div>
                </div>
                
                <div style="margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span style="font-size: 12px;">–ü–æ–¥-—Å–∏—Å—Ç–µ–º—ã</span>
                        <span style="font-size: 12px; color: #F59E0B;">${categories.pod}</span>
                    </div>
                    <div style="height: 5px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden;">
                        <div style="width: ${(categories.pod / Math.max(...Object.values(categories))) * 100}%; height: 100%; background: #6D28D9;"></div>
                    </div>
                </div>
                
                <div style="margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span style="font-size: 12px;">–†–∞—Å—Ö–æ–¥–Ω–∏–∫–∏</span>
                        <span style="font-size: 12px; color: #F59E0B;">${categories.consumables}</span>
                    </div>
                    <div style="height: 5px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden;">
                        <div style="width: ${(categories.consumables / Math.max(...Object.values(categories))) * 100}%; height: 100%; background: #5B21B6;"></div>
                    </div>
                </div>
            `;
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å UI –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        function updateUIAfterDataLoad() {
            if (!appData.isDataLoaded) return;
            
            updateUserProfile();
            updateProfileStats();
            renderAds();
            
            if (document.getElementById('page-profile').classList.contains('active')) {
                updateMyAdsList();
                updateHistory();
            }
            
            if (document.getElementById('page-faq').classList.contains('active')) {
                updateServerStatsUI();
            }
            
            if (document.getElementById('page-admin').classList.contains('active') && appData.isAdmin) {
                updateAdminStats();
                updateCurrentAdminSection();
            }
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
        function updateSyncStatus() {
            const syncText = document.getElementById('sync-text');
            const serverSyncText = document.getElementById('server-sync-text');
            
            if (appData.lastSyncTime) {
                const now = new Date();
                const diff = Math.floor((now - appData.lastSyncTime) / 1000);
                
                let text;
                if (diff < 60) {
                    text = '–¢–æ–ª—å–∫–æ —á—Ç–æ';
                } else if (diff < 3600) {
                    text = `${Math.floor(diff / 60)} –º–∏–Ω. –Ω–∞–∑–∞–¥`;
                } else {
                    text = `${Math.floor(diff / 3600)} —á–∞—Å. –Ω–∞–∑–∞–¥`;
                }
                
                if (syncText) syncText.textContent = `–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${text}`;
                if (serverSyncText) serverSyncText.textContent = `–î–∞–Ω–Ω—ã–µ: ${text}`;
            }
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–µ—Ä–≤–µ—Ä–∞
        function updateServerStatsUI() {
            if (!appData.serverStats) {
                const statsGrid = document.getElementById('server-stats-grid');
                if (statsGrid) {
                    statsGrid.innerHTML = `
                        <div class="server-stat-item">
                            <div class="server-stat-number">0</div>
                            <div class="server-stat-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                        </div>
                        <div class="server-stat-item">
                            <div class="server-stat-number">0</div>
                            <div class="server-stat-label">–û–±—ä—è–≤–ª–µ–Ω–∏–π</div>
                        </div>
                        <div class="server-stat-item">
                            <div class="server-stat-number">0</div>
                            <div class="server-stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
                        </div>
                        <div class="server-stat-item">
                            <div class="server-stat-number">0</div>
                            <div class="server-stat-label">–°–µ–≥–æ–¥–Ω—è</div>
                        </div>
                        <div class="server-stat-item">
                            <div class="server-stat-number">0</div>
                            <div class="server-stat-label">–õ–∞–π–∫–æ–≤</div>
                        </div>
                        <div class="server-stat-item">
                            <div class="server-stat-number">0</div>
                            <div class="server-stat-label">–î–∏–∑–ª–∞–π–∫–æ–≤</div>
                        </div>
                    `;
                }
                return;
            }
            
            const statsGrid = document.getElementById('server-stats-grid');
            const faqAnswer5 = document.getElementById('faq-answer-5');
            
            if (statsGrid) {
                statsGrid.innerHTML = `
                    <div class="server-stat-item">
                        <div class="server-stat-number">${appData.serverStats.totalUsers}</div>
                        <div class="server-stat-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                    </div>
                    <div class="server-stat-item">
                        <div class="server-stat-number">${appData.serverStats.totalAds}</div>
                        <div class="server-stat-label">–û–±—ä—è–≤–ª–µ–Ω–∏–π</div>
                    </div>
                    <div class="server-stat-item">
                        <div class="server-stat-number">${appData.serverStats.activeUsers}</div>
                        <div class="server-stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
                    </div>
                    <div class="server-stat-item">
                        <div class="server-stat-number">${appData.serverStats.todayAds}</div>
                        <div class="server-stat-label">–°–µ–≥–æ–¥–Ω—è</div>
                    </div>
                    <div class="server-stat-item">
                        <div class="server-stat-number">${appData.serverStats.totalLikes}</div>
                        <div class="server-stat-label">–õ–∞–π–∫–æ–≤</div>
                    </div>
                    <div class="server-stat-item">
                        <div class="server-stat-number">${appData.serverStats.totalDislikes}</div>
                        <div class="server-stat-label">–î–∏–∑–ª–∞–π–∫–æ–≤</div>
                    </div>
                `;
            }
            
            if (faqAnswer5) {
                const lastUpdated = new Date(appData.serverStats.lastUpdated).toLocaleString('ru-RU');
                faqAnswer5.innerHTML = `
                    <strong>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ Vape Market:</strong><br><br>
                    üë• <b>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:</b> ${appData.serverStats.totalUsers} (${appData.serverStats.activeUsers} –∞–∫—Ç–∏–≤–Ω—ã—Ö)<br>
                    üì¶ <b>–û–±—ä—è–≤–ª–µ–Ω–∏—è:</b> ${appData.serverStats.totalAds} (${appData.serverStats.todayAds} —Å–µ–≥–æ–¥–Ω—è)<br>
                    üëç <b>–õ–∞–π–∫–∏:</b> ${appData.serverStats.totalLikes}<br>
                    üëé <b>–î–∏–∑–ª–∞–π–∫–∏:</b> ${appData.serverStats.totalDislikes}<br><br>
                    üìä <b>–ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:</b><br>
                    ‚Ä¢ –ñ–∏–¥–∫–æ—Å—Ç–∏: ${appData.serverStats.categories.liquids}<br>
                    ‚Ä¢ –û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ: ${appData.serverStats.categories.disposable}<br>
                    ‚Ä¢ –ü–æ–¥-—Å–∏—Å—Ç–µ–º—ã: ${appData.serverStats.categories.pod}<br>
                    ‚Ä¢ –†–∞—Å—Ö–æ–¥–Ω–∏–∫–∏: ${appData.serverStats.categories.consumables}<br><br>
                    ‚è∞ <b>–û–±–Ω–æ–≤–ª–µ–Ω–æ:</b> ${lastUpdated}<br>
                    üü¢ <b>–°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞:</b> ${appData.serverStats.serverStatus}<br>
                    üî• <b>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:</b> Firebase
                `;
            }
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        async function refreshStats() {
            appData.serverStats = await FirebaseMarketServer.getStats();
            updateServerStatsUI();
            showNotification('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞', 'success');
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function initApp() {
            if (tg) {
                tg.expand();
                tg.ready();
                
                tg.setHeaderColor('#6D28D9');
                tg.setBackgroundColor('#7C3AED');
                
                tg.BackButton.show();
                tg.BackButton.onClick(function() {
                    tg.close();
                });
            }
            
            updateUserProfile();
            loadFromServer();
            
            FirebaseMarketServer.listenToAds((ads) => {
                console.log('üì° –ü–æ–ª—É—á–µ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:', ads.length);
                appData.ads = ads;
                if (appData.isDataLoaded) {
                    renderAds();
                    updateProfileStats();
                    updateMyAdsList();
                    updateServerStatsUI();
                    updateAdminStats();
                    showNotification('–ü–æ–ª—É—á–µ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ', 'info');
                }
            });
            
            for (let i = 1; i <= 6; i++) {
                const answer = document.getElementById(`faq-answer-${i}`);
                if (answer) answer.style.display = 'none';
            }
            
            setInterval(updateSyncStatus, 60000);
            
            showNotification(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${appData.currentUserData?.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}!`, 'success');
        }
        
        // ==================== –ê–î–ú–ò–ù-–§–£–ù–ö–¶–ò–ò ====================
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–æ–≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
        function switchAdminSection(section) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª—ã
            document.querySelectorAll('.admin-subsection').forEach(sub => {
                sub.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–æ–¥—Ä–∞–∑–¥–µ–ª
            document.getElementById(`admin-${section}`).classList.add('active');
            appData.currentAdminSection = section;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ä–∞–∑–¥–µ–ª–∞
            updateCurrentAdminSection();
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Ä–∞–∑–¥–µ–ª –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
        function updateCurrentAdminSection() {
            if (!appData.isAdmin) return;
            
            switch (appData.currentAdminSection) {
                case 'moderation':
                    updateAdminAdsList();
                    break;
                case 'users':
                    updateAdminUsersList();
                    break;
                case 'complaints':
                    updateAdminComplaintsList();
                    break;
                case 'analytics':
                    updateCategoriesAnalytics();
                    break;
                case 'main':
                    updateAdminStats();
                    break;
            }
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏
        function updateAdminAdsList() {
            const container = document.getElementById('admin-ads-list');
            if (!container) return;
            
            let filteredAds = [...appData.ads];
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
            switch (appData.currentAdminFilter) {
                case 'new':
                    // –û–±—ä—è–≤–ª–µ–Ω–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
                    const dayAgo = Date.now() - 24 * 60 * 60 * 1000;
                    filteredAds = filteredAds.filter(ad => 
                        ad.createdAt && new Date(ad.createdAt) > dayAgo
                    );
                    break;
                case 'complained':
                    filteredAds = filteredAds.filter(ad => ad.complaints && ad.complaints > 0);
                    break;
                case 'unverified':
                    filteredAds = filteredAds.filter(ad => !ad.verified);
                    break;
                case 'deleted':
                    filteredAds = filteredAds.filter(ad => ad.status === 'deleted');
                    break;
            }
            
            if (filteredAds.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.7);">
                        <i class="fas fa-box-open" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
                        <h3 style="margin-bottom: 10px;">–ù–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π</h3>
                        <p>–í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –ø–æ–∫–∞ –Ω–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            filteredAds.forEach(ad => {
                const date = ad.createdAt ? new Date(ad.createdAt).toLocaleDateString('ru-RU') : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                const verifiedBadge = ad.verified ? '<span class="status-badge status-verified">‚úì –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ</span>' : '';
                const complaintsBadge = ad.complaints > 0 ? `<span class="status-badge status-rejected">${ad.complaints} –∂–∞–ª–æ–±</span>` : '';
                
                html += `
                    <div class="admin-list-item">
                        <div class="admin-item-info">
                            <h4>${ad.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</h4>
                            <p>${ad.sellerUsername || '–ë–µ–∑ username'} ‚Ä¢ ${getCategoryName(ad.category)} ‚Ä¢ ${ad.price ? ad.price.toLocaleString() + ' ‚ÇΩ' : '–¶–µ–Ω–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞'} ‚Ä¢ ${date}</p>
                            <div style="display: flex; gap: 5px; margin-top: 5px;">
                                ${verifiedBadge}
                                ${complaintsBadge}
                            </div>
                        </div>
                        <div class="admin-item-actions">
                            <button class="admin-item-btn view" onclick="viewAdDetails('${ad.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="admin-item-btn edit" onclick="editAdminAd('${ad.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="admin-item-btn delete" onclick="deleteAdminAd('${ad.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
        function filterAdminAds(filter) {
            appData.currentAdminFilter = filter;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
            document.querySelectorAll('.admin-filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateAdminAdsList();
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
        function updateAdminUsersList() {
            const container = document.getElementById('admin-users-list');
            if (!container || !appData.adminData.users) return;
            
            let filteredUsers = [...appData.adminData.users];
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
            switch (appData.currentAdminFilter) {
                case 'active':
                    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
                    const weekAgo = Date.now() - 7 * 24 * 60 * 60 * 1000;
                    filteredUsers = filteredUsers.filter(user => 
                        user.lastActive && new Date(user.lastActive) > weekAgo
                    );
                    break;
                case 'blocked':
                    filteredUsers = filteredUsers.filter(user => user.blocked);
                    break;
                case 'verified':
                    filteredUsers = filteredUsers.filter(user => user.verified);
                    break;
                case 'suspicious':
                    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ä–µ–π—Ç–∏–Ω–≥–æ–º < 2.0 –∏–ª–∏ –∂–∞–ª–æ–±–∞–º–∏
                    filteredUsers = filteredUsers.filter(user => 
                        (user.rating && user.rating < 2.0) || 
                        (user.complaintsCount && user.complaintsCount > 0)
                    );
                    break;
            }
            
            if (filteredUsers.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.7);">
                        <i class="fas fa-users" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
                        <h3 style="margin-bottom: 10px;">–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
                        <p>–í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            filteredUsers.forEach(user => {
                const regDate = user.registrationDate ? new Date(user.registrationDate).toLocaleDateString('ru-RU') : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                const lastActive = user.lastActive ? new Date(user.lastActive).toLocaleDateString('ru-RU') : '–ù–∏–∫–æ–≥–¥–∞';
                
                const verifiedBadge = user.verified ? '<span class="status-badge status-verified">‚úì –ü—Ä–æ–≤–µ—Ä–µ–Ω</span>' : '';
                const blockedBadge = user.blocked ? '<span class="status-badge status-blocked">üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</span>' : '';
                const ratingBadge = user.rating ? `<span class="status-badge status-pending">‚≠ê ${user.rating.toFixed(1)}</span>` : '';
                const complaintsBadge = user.complaintsCount > 0 ? `<span class="status-badge status-rejected">${user.complaintsCount} –∂–∞–ª–æ–±</span>` : '';
                
                html += `
                    <div class="admin-list-item">
                        <div class="admin-item-info">
                            <h4>${user.name || '–ë–µ–∑ –∏–º–µ–Ω–∏'} ${user.id === appData.currentUserId ? '(–í—ã)' : ''}</h4>
                            <p>${user.username || '–ë–µ–∑ username'} ‚Ä¢ ID: ${user.id}</p>
                            <p>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: ${regDate} ‚Ä¢ –ê–∫—Ç–∏–≤–µ–Ω: ${lastActive}</p>
                            <div style="display: flex; gap: 5px; margin-top: 5px;">
                                ${verifiedBadge}
                                ${blockedBadge}
                                ${ratingBadge}
                                ${complaintsBadge}
                            </div>
                        </div>
                        <div class="admin-item-actions">
                            <button class="admin-item-btn view" onclick="viewUserDetails('${user.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            ${user.id !== appData.currentUserId ? `
                                ${user.blocked ? `
                                    <button class="admin-item-btn success" onclick="unblockUser('${user.id}')">
                                        <i class="fas fa-unlock"></i>
                                    </button>
                                ` : `
                                    <button class="admin-item-btn warning" onclick="blockUserModal('${user.id}')">
                                        <i class="fas fa-lock"></i>
                                    </button>
                                `}
                                ${!user.verified ? `
                                    <button class="admin-item-btn info" onclick="verifyUser('${user.id}')">
                                        <i class="fas fa-check"></i>
                                    </button>
                                ` : ''}
                            ` : ''}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
        function filterAdminUsers(filter) {
            appData.currentAdminFilter = filter;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
            document.querySelectorAll('.admin-filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateAdminUsersList();
        }
        
        // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function searchAdminUsers() {
            const searchTerm = document.getElementById('admin-users-search').value.toLowerCase();
            const container = document.getElementById('admin-users-list');
            
            if (!searchTerm) {
                updateAdminUsersList();
                return;
            }
            
            const filteredUsers = appData.adminData.users.filter(user => 
                (user.id && user.id.toString().includes(searchTerm)) ||
                (user.name && user.name.toLowerCase().includes(searchTerm)) ||
                (user.username && user.username.toLowerCase().includes(searchTerm))
            );
            
            if (filteredUsers.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.7);">
                        <i class="fas fa-search" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
                        <h3 style="margin-bottom: 10px;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            filteredUsers.forEach(user => {
                const regDate = user.registrationDate ? new Date(user.registrationDate).toLocaleDateString('ru-RU') : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                
                const verifiedBadge = user.verified ? '<span class="status-badge status-verified">‚úì –ü—Ä–æ–≤–µ—Ä–µ–Ω</span>' : '';
                const blockedBadge = user.blocked ? '<span class="status-badge status-blocked">üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</span>' : '';
                
                html += `
                    <div class="admin-list-item">
                        <div class="admin-item-info">
                            <h4>${user.name || '–ë–µ–∑ –∏–º–µ–Ω–∏'}</h4>
                            <p>${user.username || '–ë–µ–∑ username'} ‚Ä¢ ID: ${user.id}</p>
                            <p>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: ${regDate}</p>
                            <div style="display: flex; gap: 5px; margin-top: 5px;">
                                ${verifiedBadge}
                                ${blockedBadge}
                            </div>
                        </div>
                        <div class="admin-item-actions">
                            <button class="admin-item-btn view" onclick="viewUserDetails('${user.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            ${user.id !== appData.currentUserId ? `
                                ${user.blocked ? `
                                    <button class="admin-item-btn success" onclick="unblockUser('${user.id}')">
                                        <i class="fas fa-unlock"></i>
                                    </button>
                                ` : `
                                    <button class="admin-item-btn warning" onclick="blockUserModal('${user.id}')">
                                        <i class="fas fa-lock"></i>
                                    </button>
                                `}
                            ` : ''}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∂–∞–ª–æ–±
        function updateAdminComplaintsList() {
            const container = document.getElementById('admin-complaints-list');
            if (!container || !appData.adminData.complaints) return;
            
            let filteredComplaints = [...appData.adminData.complaints];
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
            switch (appData.currentAdminFilter) {
                case 'new':
                    filteredComplaints = filteredComplaints.filter(c => c.status === 'new');
                    break;
                case 'pending':
                    filteredComplaints = filteredComplaints.filter(c => c.status === 'pending');
                    break;
                case 'urgent':
                    filteredComplaints = filteredComplaints.filter(c => c.priority === 'urgent');
                    break;
                case 'fraud':
                    filteredComplaints = filteredComplaints.filter(c => c.type === 'fraud');
                    break;
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–Ω–∞—á–∞–ª–∞)
            filteredComplaints.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            if (filteredComplaints.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.7);">
                        <i class="fas fa-flag" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
                        <h3 style="margin-bottom: 10px;">–ñ–∞–ª–æ–± –Ω–µ—Ç</h3>
                        <p>–í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –ø–æ–∫–∞ –Ω–µ—Ç –∂–∞–ª–æ–±</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            filteredComplaints.forEach(complaint => {
                const date = complaint.createdAt ? new Date(complaint.createdAt).toLocaleDateString('ru-RU') : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                const statusClass = `status-${complaint.status || 'new'}`;
                const statusText = getComplaintStatusText(complaint.status);
                const typeText = getComplaintTypeText(complaint.type);
                
                html += `
                    <div class="admin-list-item">
                        <div class="admin-item-info">
                            <h4>–ñ–∞–ª–æ–±–∞ –Ω–∞: ${complaint.targetUsername || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</h4>
                            <p>–¢–∏–ø: ${typeText} ‚Ä¢ –û—Ç: ${complaint.reporterUsername || '–ê–Ω–æ–Ω–∏–º'} ‚Ä¢ ${date}</p>
                            <p>${complaint.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}</p>
                            <div style="display: flex; gap: 5px; margin-top: 5px;">
                                <span class="status-badge ${statusClass}">${statusText}</span>
                                ${complaint.priority === 'urgent' ? '<span class="status-badge status-rejected">–°—Ä–æ—á–Ω–æ</span>' : ''}
                            </div>
                        </div>
                        <div class="admin-item-actions">
                            <button class="admin-item-btn view" onclick="viewComplaintDetails('${complaint.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="admin-item-btn success" onclick="resolveComplaint('${complaint.id}')">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="admin-item-btn delete" onclick="rejectComplaint('${complaint.id}')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∂–∞–ª–æ–±
        function filterAdminComplaints(filter) {
            appData.currentAdminFilter = filter;
            
            document.querySelectorAll('.admin-filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateAdminComplaintsList();
        }
        
        // –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—É—Å–∞ –∂–∞–ª–æ–±—ã
        function getComplaintStatusText(status) {
            const statuses = {
                'new': '–ù–æ–≤–∞—è',
                'pending': '–í —Ä–∞–±–æ—Ç–µ',
                'resolved': '–†–µ—à–µ–Ω–∞',
                'rejected': '–û—Ç–∫–ª–æ–Ω–µ–Ω–∞'
            };
            return statuses[status] || status;
        }
        
        // –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç —Ç–∏–ø–∞ –∂–∞–ª–æ–±—ã
        function getComplaintTypeText(type) {
            const types = {
                'fraud': '–ú–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ',
                'wrong_category': '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è',
                'prohibited': '–ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã',
                'insult': '–û—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è',
                'spam': '–°–ø–∞–º',
                'other': '–î—Ä—É–≥–æ–µ'
            };
            return types[type] || type;
        }
        
        // ==================== –ê–î–ú–ò–ù-–î–ï–ô–°–¢–í–ò–Ø ====================
        
        // –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –æ–±—ä—è–≤–ª–µ–Ω–∏—è
        function viewAdDetails(adId) {
            const ad = appData.ads.find(a => a.id === adId);
            if (!ad) return;
            
            alert(`–î–µ—Ç–∞–ª–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è:\n\n` +
                  `–ù–∞–∑–≤–∞–Ω–∏–µ: ${ad.title}\n` +
                  `–ü—Ä–æ–¥–∞–≤–µ—Ü: ${ad.sellerName} (${ad.sellerUsername})\n` +
                  `–ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${getCategoryName(ad.category)}\n` +
                  `–¶–µ–Ω–∞: ${ad.price ? ad.price.toLocaleString() + ' ‚ÇΩ' : '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}\n` +
                  `–û–ø–∏—Å–∞–Ω–∏–µ: ${ad.description || '–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}\n` +
                  `–õ–∞–π–∫–∏: ${ad.likes || 0}\n` +
                  `–î–∏–∑–ª–∞–π–∫–∏: ${ad.dislikes || 0}\n` +
                  `–ñ–∞–ª–æ–±—ã: ${ad.complaints || 0}\n` +
                  `–°—Ç–∞—Ç—É—Å: ${ad.verified ? '–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ' : '–ù–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ'}\n` +
                  `–°–æ–∑–¥–∞–Ω–æ: ${ad.createdAt ? new Date(ad.createdAt).toLocaleString('ru-RU') : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}`);
        }
        
        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è (–∞–¥–º–∏–Ω)
        function editAdminAd(adId) {
            const ad = appData.ads.find(a => a.id === adId);
            if (!ad) return;
            
            const newTitle = prompt('–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è:', ad.title);
            if (newTitle === null) return;
            
            const newPrice = prompt('–ù–æ–≤–∞—è —Ü–µ–Ω–∞:', ad.price);
            if (newPrice === null) return;
            
            const newDescription = prompt('–ù–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:', ad.description);
            if (newDescription === null) return;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤ Firebase
            FirebaseMarketServer.updateAd(adId, {
                title: newTitle,
                price: Number(newPrice),
                description: newDescription,
                updatedAt: firebase.database.ServerValue.TIMESTAMP
            }).then(success => {
                if (success) {
                    showNotification('–û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ', 'success');
                    loadAdminData();
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏', 'error');
                }
            });
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è (–∞–¥–º–∏–Ω)
        function deleteAdminAd(adId) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ?\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                return;
            }
            
            const ad = appData.ads.find(a => a.id === adId);
            if (!ad) return;
            
            const reason = prompt('–ü—Ä–∏—á–∏–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è:', '–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª');
            if (reason === null) return;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –æ–±—ä—è–≤–ª–µ–Ω–∏—è
            FirebaseMarketServer.updateAd(adId, {
                status: 'deleted',
                deleteReason: reason,
                deletedAt: firebase.database.ServerValue.TIMESTAMP
            }).then(success => {
                if (success) {
                    showNotification('–û–±—ä—è–≤–ª–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ', 'warning');
                    loadAdminData();
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏', 'error');
                }
            });
        }
        
        // –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function viewUserDetails(userId) {
            const user = appData.adminData.users.find(u => u.id === userId);
            if (!user) return;
            
            const adsCount = appData.ads.filter(ad => ad.sellerId === userId).length;
            const lastActive = user.lastActive ? new Date(user.lastActive).toLocaleString('ru-RU') : '–ù–∏–∫–æ–≥–¥–∞';
            const regDate = user.registrationDate ? new Date(user.registrationDate).toLocaleString('ru-RU') : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
            
            alert(`–î–µ—Ç–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\n\n` +
                  `ID: ${user.id}\n` +
                  `–ò–º—è: ${user.name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}\n` +
                  `Username: ${user.username || '–ù–µ —É–∫–∞–∑–∞–Ω'}\n` +
                  `–†–µ–π—Ç–∏–Ω–≥: ${user.rating ? user.rating.toFixed(1) : '0.0'}\n` +
                  `–û–±—ä—è–≤–ª–µ–Ω–∏—è: ${adsCount}\n` +
                  `–õ–∞–π–∫–∏: ${user.likesCount || 0}\n` +
                  `–î–∏–∑–ª–∞–π–∫–∏: ${user.dislikesCount || 0}\n` +
                  `–ñ–∞–ª–æ–±—ã: ${user.complaintsCount || 0}\n` +
                  `–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è: ${user.warnings || 0}\n` +
                  `–°—Ç–∞—Ç—É—Å: ${user.blocked ? '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' : '–ê–∫—Ç–∏–≤–µ–Ω'}\n` +
                  `–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω: ${user.verified ? '–î–∞' : '–ù–µ—Ç'}\n` +
                  `–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: ${regDate}\n` +
                  `–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: ${lastActive}`);
        }
        
        // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function blockUserModal(userId) {
            const user = appData.adminData.users.find(u => u.id === userId);
            if (!user || user.id === appData.currentUserId) return;
            
            const reason = prompt('–ü—Ä–∏—á–∏–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:', '–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª');
            if (reason === null) return;
            
            const duration = prompt('–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (–≤ —á–∞—Å–∞—Ö, –∏–ª–∏ "permanent" –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π):', '24');
            if (duration === null) return;
            
            if (confirm(`–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${user.name || user.id}?\n–ü—Ä–∏—á–∏–Ω–∞: ${reason}\n–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${duration === 'permanent' ? '–ü–æ—Å—Ç–æ—è–Ω–Ω–æ' : duration + ' —á–∞—Å–æ–≤'}`)) {
                FirebaseMarketServer.blockUser(userId, reason, duration).then(success => {
                    if (success) {
                        showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω', 'warning');
                        loadAdminData();
                    } else {
                        showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ', 'error');
                    }
                });
            }
        }
        
        // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function unblockUser(userId) {
            const user = appData.adminData.users.find(u => u.id === userId);
            if (!user || user.id === appData.currentUserId) return;
            
            if (confirm(`–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${user.name || user.id}?`)) {
                FirebaseMarketServer.unblockUser(userId).then(success => {
                    if (success) {
                        showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω', 'success');
                        loadAdminData();
                    } else {
                        showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–µ', 'error');
                    }
                });
            }
        }
        
        // –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function verifyUser(userId) {
            const user = appData.adminData.users.find(u => u.id === userId);
            if (!user || user.id === appData.currentUserId) return;
            
            if (confirm(`–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${user.name || user.id}?\n–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –æ—Ç–º–µ—Ç–∫—É.`)) {
                FirebaseMarketServer.verifyUser(userId).then(success => {
                    if (success) {
                        showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω', 'success');
                        loadAdminData();
                    } else {
                        showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏', 'error');
                    }
                });
            }
        }
        
        // –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –∂–∞–ª–æ–±—ã
        function viewComplaintDetails(complaintId) {
            const complaint = appData.adminData.complaints.find(c => c.id === complaintId);
            if (!complaint) return;
            
            const date = complaint.createdAt ? new Date(complaint.createdAt).toLocaleString('ru-RU') : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
            
            alert(`–î–µ—Ç–∞–ª–∏ –∂–∞–ª–æ–±—ã:\n\n` +
                  `ID: ${complaint.id}\n` +
                  `–¢–∏–ø: ${getComplaintTypeText(complaint.type)}\n` +
                  `–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: ${complaint.priority || '–°—Ä–µ–¥–Ω–∏–π'}\n` +
                  `–°—Ç–∞—Ç—É—Å: ${getComplaintStatusText(complaint.status)}\n` +
                  `–ù–∞ –∫–æ–≥–æ: ${complaint.targetUsername || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}\n` +
                  `–û—Ç –∫–æ–≥–æ: ${complaint.reporterUsername || '–ê–Ω–æ–Ω–∏–º'}\n` +
                  `–û–ø–∏—Å–∞–Ω–∏–µ: ${complaint.description || '–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}\n` +
                  `–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞: ${complaint.evidence ? '–ï—Å—Ç—å' : '–ù–µ—Ç'}\n` +
                  `–î–∞—Ç–∞: ${date}\n` +
                  `–ó–∞–º–µ—Ç–∫–∞ –∞–¥–º–∏–Ω–∞: ${complaint.adminNote || '–ù–µ—Ç'}`);
        }
        
        // –†–µ—à–∏—Ç—å –∂–∞–ª–æ–±—É
        function resolveComplaint(complaintId) {
            const complaint = appData.adminData.complaints.find(c => c.id === complaintId);
            if (!complaint) return;
            
            const note = prompt('–ó–∞–º–µ—Ç–∫–∞ –∞–¥–º–∏–Ω–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):', '–ñ–∞–ª–æ–±–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∞, –Ω–∞—Ä—É—à–µ–Ω–∏—è —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã');
            
            FirebaseMarketServer.updateComplaintStatus(complaintId, 'resolved', note).then(success => {
                if (success) {
                    showNotification('–ñ–∞–ª–æ–±–∞ –æ—Ç–º–µ—á–µ–Ω–∞ –∫–∞–∫ —Ä–µ—à–µ–Ω–Ω–∞—è', 'success');
                    loadAdminData();
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∂–∞–ª–æ–±—ã', 'error');
                }
            });
        }
        
        // –û—Ç–∫–ª–æ–Ω–∏—Ç—å –∂–∞–ª–æ–±—É
        function rejectComplaint(complaintId) {
            const complaint = appData.adminData.complaints.find(c => c.id === complaintId);
            if (!complaint) return;
            
            const note = prompt('–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è:', '–ñ–∞–ª–æ–±–∞ –Ω–µ–æ–±–æ—Å–Ω–æ–≤–∞–Ω–∞');
            
            FirebaseMarketServer.updateComplaintStatus(complaintId, 'rejected', note).then(success => {
                if (success) {
                    showNotification('–ñ–∞–ª–æ–±–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞', 'warning');
                    loadAdminData();
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∂–∞–ª–æ–±—ã', 'error');
                }
            });
        }
        
        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
        function sendBannerToAll() {
            const title = document.getElementById('banner-title').value.trim();
            const text = document.getElementById('banner-text').value.trim();
            const type = document.getElementById('banner-type').value;
            const duration = document.getElementById('banner-duration').value;
            
            if (!title || !text) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ç–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è', 'error');
                return;
            }
            
            const notificationData = {
                title: title,
                text: text,
                type: type,
                duration: duration,
                sentBy: appData.currentUserId,
                sentAt: new Date().toISOString()
            };
            
            FirebaseMarketServer.createSystemNotification(notificationData).then(notificationId => {
                if (notificationId) {
                    showNotification('–°–∏—Å—Ç–µ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º', 'success');
                    clearBannerForm();
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
                    const historyItem = document.createElement('div');
                    historyItem.className = 'admin-list-item';
                    historyItem.innerHTML = `
                        <div class="admin-item-info">
                            <h4>${title}</h4>
                            <p>${new Date().toLocaleString('ru-RU')} ‚Ä¢ –¢–∏–ø: ${type}</p>
                            <p>${text.substring(0, 100)}${text.length > 100 ? '...' : ''}</p>
                        </div>
                    `;
                    document.getElementById('admin-banners-history').prepend(historyItem);
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è', 'error');
                }
            });
        }
        
        // –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É –±–∞–Ω–Ω–µ—Ä–∞
        function clearBannerForm() {
            document.getElementById('banner-title').value = '';
            document.getElementById('banner-text').value = '';
            document.getElementById('banner-type').value = 'info';
            document.getElementById('banner-duration').value = '24';
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function exportAnalytics() {
            const analyticsData = {
                totalUsers: appData.adminData.users.length,
                totalAds: appData.ads.length,
                complaints: {
                    total: appData.adminData.complaints.length,
                    new: appData.adminData.complaints.filter(c => c.status === 'new').length,
                    pending: appData.adminData.complaints.filter(c => c.status === 'pending').length,
                    resolved: appData.adminData.complaints.filter(c => c.status === 'resolved').length,
                    rejected: appData.adminData.complaints.filter(c => c.status === 'rejected').length
                },
                categories: {},
                exportDate: new Date().toISOString()
            };
            
            // –°—á–∏—Ç–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            appData.ads.forEach(ad => {
                const category = ad.category || 'other';
                analyticsData.categories[category] = (analyticsData.categories[category] || 0) + 1;
            });
            
            // –°–æ–∑–¥–∞–µ–º –∏ —Å–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
            const dataStr = JSON.stringify(analyticsData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `vape-market-analytics-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤ JSON', 'success');
        }
        
        // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è
        function useTemplate(templateId) {
            const templates = {
                1: '–í–∞—à –∞–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∑–∞ –ø–æ–ø—ã—Ç–∫—É –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ Vape Market. –î–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É @nukm0.',
                2: '–í—ã –ø–æ–ª—É—á–∏–ª–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∑–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã. –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –Ω–∞—Ä—É—à–µ–Ω–∏–∏ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç –±—É–¥–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω.'
            };
            
            const template = templates[templateId];
            if (template) {
                navigator.clipboard.writeText(template).then(() => {
                    showNotification('–®–∞–±–ª–æ–Ω —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
                });
            }
        }
        
        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª–æ
        function editRule(ruleId) {
            alert('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö');
        }
        
        // ==================== –û–ë–©–ò–ï –§–£–ù–ö–¶–ò–ò ====================
        
        // –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ UI
        function updateUserProfile() {
            if (!appData.currentUserData) return;
            
            const profileName = document.getElementById('profileName');
            const profileUsername = document.getElementById('profileUsername');
            const profileAvatar = document.getElementById('profileAvatar');
            
            let fullName = appData.currentUserData.first_name;
            if (appData.currentUserData.last_name) {
                fullName += ' ' + appData.currentUserData.last_name;
            }
            profileName.textContent = fullName;
            
            if (appData.currentUserData.username) {
                profileUsername.textContent = '@' + appData.currentUserData.username;
            } else {
                profileUsername.textContent = '–ë–µ–∑ username';
            }
            
            if (appData.currentUserData.photo_url) {
                profileAvatar.innerHTML = `<img src="${appData.currentUserData.photo_url}" alt="–ê–≤–∞—Ç–∞—Ä">`;
            } else {
                const firstLetter = (appData.currentUserData.first_name || '–ü').charAt(0).toUpperCase();
                profileAvatar.innerHTML = `<span>${firstLetter}</span>`;
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü
        function switchPage(page) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            document.querySelectorAll('.page').forEach(p => {
                p.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            document.getElementById(`page-${page}`).classList.add('active');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            document.querySelectorAll('.nav-item').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.remove('admin-active');
            });
            
            const navItem = document.querySelector(`[data-page="${page}"]`);
            if (navItem) {
                navItem.classList.add('active');
                if (page === 'admin') {
                    navItem.classList.add('admin-active');
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
            const titles = {
                'ads': 'Vape Market',
                'profile': '–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç',
                'faq': '–ü–æ–º–æ—â—å',
                'admin': 'üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å'
            };
            document.getElementById('header-title').textContent = titles[page] || 'Vape Market';
            
            // –°–∫—Ä—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
            hideAddForm();
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∞–¥–º–∏–Ω-—Å–µ–∫—Ü–∏—é –Ω–∞ –≥–ª–∞–≤–Ω—É—é
            if (page !== 'admin') {
                switchAdminSection('main');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            if (appData.isDataLoaded) {
                if (page === 'profile') {
                    updateProfileStats();
                    updateMyAdsList();
                    updateHistory();
                }
                
                if (page === 'faq') {
                    updateServerStatsUI();
                }
                
                if (page === 'admin' && appData.isAdmin) {
                    loadAdminData();
                }
            }
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ
        function switchProfileTab(tab) {
            document.querySelectorAll('.profile-tab').forEach(t => {
                t.classList.remove('active');
            });
            document.querySelector(`[onclick="switchProfileTab('${tab}')"]`).classList.add('active');
            
            document.querySelectorAll('.profile-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tab}-tab`).classList.add('active');
            
            if (tab === 'history' && appData.isDataLoaded) {
                updateHistory();
            }
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
        function toggleAddForm() {
            const form = document.getElementById('addAdForm');
            const btnText = document.getElementById('toggle-btn-text');
            
            if (form.classList.contains('active')) {
                form.classList.remove('active');
                btnText.textContent = '–î–æ–±–∞–≤–∏—Ç—å';
            } else {
                form.classList.add('active');
                btnText.textContent = '–°–∫—Ä—ã—Ç—å';
            }
        }
        
        // –°–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
        function hideAddForm() {
            const form = document.getElementById('addAdForm');
            const btnText = document.getElementById('toggle-btn-text');
            
            form.classList.remove('active');
            btnText.textContent = '–î–æ–±–∞–≤–∏—Ç—å';
            clearAddForm();
        }
        
        // –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
        function filterCategory(category) {
            appData.currentCategory = category;
            
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            renderAds();
        }
        
        // –†–µ–Ω–¥–µ—Ä –æ–±—ä—è–≤–ª–µ–Ω–∏–π (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
        function renderAds() {
            const container = document.getElementById('ads-container');
            
            if (!appData.isDataLoaded) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.7);">
                        <i class="fas fa-spinner fa-spin" style="font-size: 48px; margin-bottom: 20px;"></i>
                        <h3 style="margin-bottom: 10px;">–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π...</h3>
                        <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            const filteredAds = appData.currentCategory === 'all' 
                ? appData.ads 
                : appData.ads.filter(ad => ad.category === appData.currentCategory);
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
            const activeAds = filteredAds.filter(ad => ad.status !== 'deleted');
            
            activeAds.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            if (activeAds.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.7);">
                        <i class="fas fa-box-open" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
                        <h3 style="margin-bottom: 10px;">–ù–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π</h3>
                        <p>–í —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫–∞ –Ω–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π</p>
                        <p style="font-size: 12px; margin-top: 10px; color: rgba(255,255,255,0.5);">
                            –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º - —Å–æ–∑–¥–∞–π—Ç–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ!
                        </p>
                    </div>
                `;
                return;
            }
            
            activeAds.forEach(ad => {
                const rating = calculateRating(ad.sellerId);
                const userRating = appData.userRatings[ad.sellerId]?.[appData.currentUserId];
                const isOwnAd = ad.sellerId === appData.currentUserId;
                
                const adElement = document.createElement('div');
                adElement.className = 'advertisement-card';
                adElement.id = `ad-${ad.id}`;
                
                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ–æ—Ç–æ
                const photoElements = [];
                
                if (ad.photoUrls && ad.photoUrls.length > 0 && ad.photoUrls[0] !== null) {
                    // –ï—Å—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ
                    ad.photoUrls.forEach((photoUrl, index) => {
                        if (photoUrl && photoUrl !== 'null') {
                            photoElements.push(`
                                <div class="photo-item" onclick="openPhotoViewer('${ad.id}', ${index})">
                                    <img src="${photoUrl}" alt="–§–æ—Ç–æ ${index + 1}" onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDEyMCAxMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEyMCIgaGVpZ2h0PSIxMjAiIHJ4PSIxNSIgZmlsbD0iIzgzNUFGOSIvPjxwYXRoIGQ9Ik03NSA2MEw1NSA3NUw0NSA2MEw2MCA0NUw3NSA2MFoiIGZpbGw9IndoaXRlIi8+PHRleHQgeD0iNjAiIHk9Ijg1IiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTIiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5GJmFtcDsjeDQ0Mzt0byAxPC90ZXh0Pjwvc3ZnPg=='">
                                    <div class="photo-label">–§–æ—Ç–æ ${index + 1}</div>
                                </div>
                            `);
                        }
                    });
                }
                
                // –ï—Å–ª–∏ –Ω–µ—Ç —Ñ–æ—Ç–æ –∏–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫–∏
                if (photoElements.length === 0) {
                    const numPhotos = Math.min(ad.photos || 1, 3);
                    for (let i = 0; i < numPhotos; i++) {
                        const colors = ['#835AF9', '#7C3AED', '#6D28D9'];
                        const color = colors[i % colors.length];
                        photoElements.push(`
                            <div class="photo-item">
                                <div class="photo-placeholder" style="background: ${color};">
                                    <i class="fas fa-image"></i>
                                    <span>–§–æ—Ç–æ ${i + 1}</span>
                                </div>
                                <div class="photo-label">–§–æ—Ç–æ ${i + 1}</div>
                            </div>
                        `);
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø—Ä–æ–¥–∞–≤–µ—Ü –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–º
                const sellerUser = appData.adminData.users?.find(u => u.id === ad.sellerId);
                const verifiedBadge = sellerUser?.verified ? '<span class="status-badge status-verified" style="margin-left: 5px; font-size: 10px;">‚úì</span>' : '';
                
                adElement.innerHTML = `
                    <div class="seller-header">
                        <div class="seller-avatar">
                            ${ad.sellerAvatar ? `<img src="${ad.sellerAvatar}" alt="–ê–≤–∞—Ç–∞—Ä">` : 
                              `<span style="font-size: 18px; font-weight: bold;">${ad.sellerName?.charAt(0) || '–ü'}</span>`}
                        </div>
                        <div class="seller-info">
                            <div class="seller-name">${ad.sellerName || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π'} ${verifiedBadge}</div>
                            <div class="seller-username">${ad.sellerUsername || '–ë–µ–∑ username'}</div>
                            <div class="seller-stats">
                                <div class="seller-stat stat-rating">
                                    <i class="fas fa-star"></i>
                                    <span id="rating-${ad.sellerId}">${calculateRating(ad.sellerId).toFixed(1)}</span>
                                </div>
                                <div class="seller-stat stat-likes">
                                    <i class="fas fa-thumbs-up"></i>
                                    <span id="ad${ad.id}-likes">${ad.likes || 0}</span>
                                </div>
                                <div class="seller-stat stat-dislikes">
                                    <i class="fas fa-thumbs-down"></i>
                                    <span id="ad${ad.id}-dislikes">${ad.dislikes || 0}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="photo-gallery">
                        ${photoElements.join('')}
                    </div>

                    <div class="product-info">
                        <div class="product-title">${ad.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</div>
                        <div class="product-category">${getCategoryName(ad.category)}</div>
                        <div class="product-price">${(ad.price || 0).toLocaleString()} ‚ÇΩ</div>
                        <div class="product-description">${ad.description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}</div>
                    </div>

                    <div class="action-grid">
                        <button class="rate-btn like-btn ${userRating === 'like' ? 'active' : ''} ${isOwnAd ? 'disabled' : ''}" 
                                onclick="rateSeller('${ad.sellerId}', 'like', '${ad.id}')"
                                ${isOwnAd ? 'disabled' : ''}>
                            <i class="fas fa-thumbs-up"></i>
                        </button>
                        
                        <button class="contact-btn" onclick="contactSeller('${ad.sellerUsername || '–ë–µ–∑ username'}', '${ad.id}', '${ad.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}', '${ad.category || 'other'}', ${ad.price || 0})">
                            <i class="fas fa-paper-plane"></i>
                            –ù–∞–ø–∏—Å–∞—Ç—å –ø—Ä–æ–¥–∞–≤—Ü—É
                        </button>
                        
                        <button class="rate-btn dislike-btn ${userRating === 'dislike' ? 'active' : ''} ${isOwnAd ? 'disabled' : ''}" 
                                onclick="rateSeller('${ad.sellerId}', 'dislike', '${ad.id}')"
                                ${isOwnAd ? 'disabled' : ''}>
                            <i class="fas fa-thumbs-down"></i>
                        </button>
                    </div>
                `;
                
                container.appendChild(adElement);
            });
        }
        
        // –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–µ–π—Ç–∏–Ω–≥
        function calculateRating(sellerId) {
            if (!appData.userRatings[sellerId]) return 0.1;
            
            const ratings = Object.values(appData.userRatings[sellerId]);
            if (ratings.length === 0) return 0.1;
            
            const likes = ratings.filter(r => r === 'like').length;
            const dislikes = ratings.filter(r => r === 'dislike').length;
            const total = likes + dislikes;
            
            if (total === 0) return 0.1;
            return 0.1 + (likes / total) * 4.9;
        }
        
        // –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ—Ç–æ
        function openPhotoViewer(adId, photoIndex = 0) {
            const ad = appData.ads.find(a => a.id === adId);
            if (!ad || !ad.photoUrls || ad.photoUrls.length === 0 || ad.photoUrls[0] === null) {
                showNotification('–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 'error');
                return;
            }
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–æ—Ç–æ
            const validPhotoUrls = ad.photoUrls.filter(url => url && url !== 'null');
            if (validPhotoUrls.length === 0) {
                showNotification('–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 'error');
                return;
            }
            
            appData.currentPhotoList = validPhotoUrls;
            appData.currentPhotoIndex = Math.min(photoIndex, validPhotoUrls.length - 1);
            
            const modal = document.getElementById('photoModal');
            const modalImg = document.getElementById('modalPhoto');
            const counter = document.getElementById('photoCounter');
            
            modalImg.src = validPhotoUrls[appData.currentPhotoIndex];
            modalImg.onerror = function() {
                this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjQwMCIgdmlld0JveD0iMCAwIDQwMCA0MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjQwMCIgaGVpZ2h0PSI0MDAiIGZpbGw9IiM4MzVBRjkiLz48cGF0aCBkPSJNMTYwIDE5MEwyNDAgMjQwTDE4MCAxOTBMMjIwIDE0MEwxNjAgMTkwWiIgZmlsbD0id2hpdGUiLz48dGV4dCB4PSIyMDAiIHk9IjI4MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjI0IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+Rm90byBub3QgZm91bmQ8L3RleHQ+PC9zdmc+';
            };
            
            counter.textContent = `${appData.currentPhotoIndex + 1} / ${validPhotoUrls.length}`;
            
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        // –ó–∞–∫—Ä—ã—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ—Ç–æ
        function closePhotoModal() {
            const modal = document.getElementById('photoModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }
        
        // –°–ª–µ–¥—É—é—â–µ–µ —Ñ–æ—Ç–æ
        function nextPhoto() {
            if (appData.currentPhotoList.length === 0) return;
            
            appData.currentPhotoIndex = (appData.currentPhotoIndex + 1) % appData.currentPhotoList.length;
            const modalImg = document.getElementById('modalPhoto');
            modalImg.src = appData.currentPhotoList[appData.currentPhotoIndex];
            modalImg.onerror = function() {
                this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjQwMCIgdmlld0JveD0iMCAwIDQwMCA0MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjQwMCIgaGVpZ2h0PSI0MDAiIGZpbGw9IiM4MzVBRjkiLz48cGF0aCBkPSJNMTYwIDE5MEwyNDAgMjQwTDE4MCAxOTBMMjIwIDE0MEwxNjAgMTkwWiIgZmlsbD0id2hpdGUiLz48dGV4dCB4PSIyMDAiIHk9IjI4MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjI0IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+Rm90byBub3QgZm91bmQ8L3RleHQ+PC9zdmc+';
            };
            document.getElementById('photoCounter').textContent = 
                `${appData.currentPhotoIndex + 1} / ${appData.currentPhotoList.length}`;
        }
        
        // –ü—Ä–µ–¥—ã–¥—É—â–µ–µ —Ñ–æ—Ç–æ
        function prevPhoto() {
            if (appData.currentPhotoList.length === 0) return;
            
            appData.currentPhotoIndex = appData.currentPhotoIndex === 0 
                ? appData.currentPhotoList.length - 1 
                : appData.currentPhotoIndex - 1;
            
            const modalImg = document.getElementById('modalPhoto');
            modalImg.src = appData.currentPhotoList[appData.currentPhotoIndex];
            modalImg.onerror = function() {
                this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjQwMCIgdmlld0JveD0iMCAwIDQwMCA0MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjQwMCIgaGVpZ2h0PSI0MDAiIGZpbGw9IiM4MzVBRjkiLz48cGF0aCBkPSJNMTYwIDE5MEwyNDAgMjQwTDE4MCAxOTBMMjIwIDE0MEwxNjAgMTkwWiIgZmlsbD0id2hpdGUiLz48dGV4dCB4PSIyMDAiIHk9IjI4MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjI0IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1iZGRsZSI+Rm90byBub3QgZm91bmQ8L3RleHQ+PC9zdmc+';
            };
            document.getElementById('photoCounter').textContent = 
                `${appData.currentPhotoIndex + 1} / ${appData.currentPhotoList.length}`;
        }
        
        // –û—Ü–µ–Ω–∏—Ç—å –ø—Ä–æ–¥–∞–≤—Ü–∞
        async function rateSeller(sellerId, type, adId) {
            if (!appData.isDataLoaded) {
                showNotification('–î–∞–Ω–Ω—ã–µ –µ—â–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è', 'warning');
                return;
            }
            
            const ad = appData.ads.find(a => a.id === adId);
            if (!ad) return;
            
            if (ad.sellerId === appData.currentUserId) {
                showNotification('–ù–µ–ª—å–∑—è –æ—Ü–µ–Ω–∏–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ', 'warning');
                return;
            }
            
            const userRating = appData.userRatings[sellerId]?.[appData.currentUserId];
            
            if (userRating === type) {
                showNotification('–í—ã —É–∂–µ –ø–æ—Å—Ç–∞–≤–∏–ª–∏ —ç—Ç—É –æ—Ü–µ–Ω–∫—É', 'warning');
                return;
            }
            
            const success = await FirebaseMarketServer.updateRating(sellerId, appData.currentUserId, type);
            
            if (success) {
                if (!appData.userRatings[sellerId]) {
                    appData.userRatings[sellerId] = {};
                }
                appData.userRatings[sellerId][appData.currentUserId] = type;
                
                appData.userRatings = await FirebaseMarketServer.getRatings();
                
                renderAds();
                updateProfileStats();
                updateServerStatsUI();
                updateAdminStats();
                
                showNotification(`–í—ã –ø–æ—Å—Ç–∞–≤–∏–ª–∏ ${type === 'like' ? '–ª–∞–π–∫' : '–¥–∏–∑–ª–∞–π–∫'}`, 'success');
            } else {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ü–µ–Ω–∫–µ', 'error');
            }
        }
        
        // –ù–∞–ø–∏—Å–∞—Ç—å –ø—Ä–æ–¥–∞–≤—Ü—É
        async function contactSeller(username, adId, adTitle, category, price) {
            if (!appData.isDataLoaded) {
                showNotification('–î–∞–Ω–Ω—ã–µ –µ—â–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è', 'warning');
                return;
            }
            
            const ad = appData.ads.find(a => a.id === adId);
            if (!ad) return;
            
            const categoryName = getCategoryName(category);
            const message = `–ü—Ä–∏–≤–µ—Ç! –í–∏–∂—É —Ç–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –≤ Vape Market:\n\n` +
                           `üì¶ –¢–æ–≤–∞—Ä: ${adTitle}\n` +
                           `üè∑Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${categoryName}\n` +
                           `üí∞ –¶–µ–Ω–∞: ${price.toLocaleString()} ‚ÇΩ\n\n` +
                           `–ú–æ–∂–µ—à—å —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Ç–æ–≤–∞—Ä–µ?`;
            
            const historyItem = {
                id: Date.now(),
                adId: adId,
                title: adTitle,
                sellerUsername: username,
                date: new Date().toLocaleDateString('ru-RU'),
                category: categoryName,
                price: price
            };
            
            await FirebaseMarketServer.addToHistory(appData.currentUserId, historyItem);
            
            appData.history = await FirebaseMarketServer.getUserHistory(appData.currentUserId);
            
            if (document.getElementById('page-profile').classList.contains('active')) {
                updateHistory();
            }
            
            if (tg) {
                try {
                    const cleanUsername = username.replace('@', '');
                    const encodedMessage = encodeURIComponent(message);
                    const telegramUrl = `https://t.me/${cleanUsername}?text=${encodedMessage}`;
                    
                    tg.openTelegramLink(telegramUrl);
                    showNotification(`–û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —á–∞—Ç —Å ${username}`, 'success');
                } catch (error) {
                    tg.showAlert(`–î–ª—è —Å–≤—è–∑–∏ —Å –ø—Ä–æ–¥–∞–≤—Ü–æ–º –Ω–∞–ø–∏—à–∏—Ç–µ ${username} –≤ Telegram`);
                }
            } else {
                alert(`–°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è ${username}:\n\n${message}`);
                showNotification(`–°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è ${username} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ`, 'info');
            }
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
        function updateHistory() {
            const historyList = document.getElementById('historyList');
            
            if (!appData.isDataLoaded) {
                historyList.innerHTML = '<div style="text-align: center; color: #D8B4FE; padding: 20px;">–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏...</div>';
                return;
            }
            
            historyList.innerHTML = '';
            
            if (appData.history.length === 0) {
                historyList.innerHTML = '<div style="text-align: center; color: #D8B4FE; padding: 20px;">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</div>';
                return;
            }
            
            appData.history.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <div class="history-info">
                        <h4>${item.title}</h4>
                        <p>${item.sellerUsername} ‚Ä¢ ${item.category} ‚Ä¢ ${item.price.toLocaleString()} ‚ÇΩ ‚Ä¢ ${item.date}</p>
                    </div>
                    <button class="remove-history-btn" onclick="removeFromHistory('${item.id}')">
                        –£–¥–∞–ª–∏—Ç—å
                    </button>
                `;
                historyList.appendChild(historyItem);
            });
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–æ–∏—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π
        function updateMyAdsList() {
            const myAdsList = document.getElementById('myAdsList');
            
            if (!appData.isDataLoaded) {
                myAdsList.innerHTML = '<div style="text-align: center; color: #D8B4FE; padding: 20px;">–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π...</div>';
                return;
            }
            
            const myAds = appData.ads.filter(ad => ad.sellerId === appData.currentUserId && ad.status !== 'deleted');
            
            if (myAds.length === 0) {
                myAdsList.innerHTML = '<div style="text-align: center; color: #D8B4FE; padding: 20px;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π</div>';
                return;
            }
            
            myAdsList.innerHTML = '';
            
            myAds.forEach(ad => {
                const rating = calculateRating(appData.currentUserId);
                
                const adElement = document.createElement('div');
                adElement.className = 'my-ad-item';
                
                adElement.innerHTML = `
                    <div class="my-ad-header">
                        <div class="my-ad-title">${ad.title}</div>
                        <div class="my-ad-price">${ad.price.toLocaleString()} ‚ÇΩ</div>
                    </div>
                    <div class="product-category" style="display: inline-block; margin-bottom: 10px;">
                        ${getCategoryName(ad.category)}
                    </div>
                    <div class="my-ad-description">${ad.description}</div>
                    <div style="display: flex; gap: 15px; font-size: 12px; color: #D8B4FE;">
                        <div><i class="fas fa-thumbs-up"></i> ${ad.likes || 0}</div>
                        <div><i class="fas fa-thumbs-down"></i> ${ad.dislikes || 0}</div>
                        <div><i class="fas fa-star"></i> ${rating.toFixed(1)}</div>
                        ${ad.complaints > 0 ? `<div><i class="fas fa-flag"></i> ${ad.complaints} –∂–∞–ª–æ–±</div>` : ''}
                    </div>
                    <div class="my-ad-actions">
                        <button class="edit-ad-btn" onclick="editAd('${ad.id}')">
                            <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                        <button class="delete-ad-btn" onclick="deleteAd('${ad.id}')">
                            <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </div>
                `;
                myAdsList.appendChild(adElement);
            });
        }
        
        // –£–¥–∞–ª–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
        async function deleteAd(adId) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ?')) {
                return;
            }
            
            const ad = appData.ads.find(a => a.id === adId);
            if (!ad) return;
            
            const success = await FirebaseMarketServer.deleteAd(adId, ad.sellerId);
            
            if (success) {
                appData.ads = appData.ads.filter(ad => ad.id !== adId);
                
                renderAds();
                updateProfileStats();
                updateMyAdsList();
                updateServerStatsUI();
                updateAdminStats();
                showNotification('–û–±—ä—è–≤–ª–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ', 'warning');
            } else {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏', 'error');
            }
        }
        
        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
        function editAd(adId) {
            const ad = appData.ads.find(a => a.id === adId);
            if (!ad) return;
            
            document.getElementById('adTitle').value = ad.title;
            document.getElementById('adCategory').value = ad.category;
            document.getElementById('adPrice').value = ad.price;
            document.getElementById('adDescription').value = ad.description;
            
            appData.uploadedPhotos = [];
            if (ad.photoUrls && ad.photoUrls.length > 0) {
                ad.photoUrls.forEach((url, index) => {
                    if (url && url !== 'null') {
                        appData.uploadedPhotos.push({
                            id: Date.now() + index,
                            url: url,
                            file: null
                        });
                    }
                });
            }
            
            updatePhotoPreviews();
            
            appData.editingAdId = adId;
            
            toggleAddForm();
            
            showNotification('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è', 'info');
        }
        
        // –£–¥–∞–ª–∏—Ç—å –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
        async function removeFromHistory(id) {
            appData.history = appData.history.filter(item => item.id !== id);
            updateHistory();
            showNotification('–£–¥–∞–ª–µ–Ω–æ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏', 'warning');
        }
        
        // –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
        async function clearHistory() {
            if (!appData.isDataLoaded || appData.history.length === 0) {
                showNotification('–ò—Å—Ç–æ—Ä–∏—è —É–∂–µ –ø—É—Å—Ç–∞', 'info');
                return;
            }
            
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é?')) {
                return;
            }
            
            const success = await FirebaseMarketServer.clearUserHistory(appData.currentUserId);
            
            if (success) {
                appData.history = [];
                updateHistory();
                showNotification('–ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞', 'warning');
            } else {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏', 'error');
            }
        }
        
        // –û—Ç–∫—Ä—ã—Ç—å –≤—ã–±–æ—Ä —Ñ–æ—Ç–æ
        function openPhotoPicker() {
            document.getElementById('photoInput').click();
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
        function handlePhotoUpload(event) {
            const files = event.target.files;
            const maxFiles = 3;
            
            if (files.length > maxFiles) {
                showNotification(`–ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ–ª—å–∫–æ ${maxFiles} —Ñ–æ—Ç–æ!`, 'error');
                return;
            }
            
            if (appData.uploadedPhotos.length + files.length > maxFiles) {
                showNotification(`–ú–∞–∫—Å–∏–º—É–º ${maxFiles} —Ñ–æ—Ç–æ!`, 'error');
                return;
            }
            
            const promises = [];
            
            for (let i = 0; i < Math.min(files.length, maxFiles - appData.uploadedPhotos.length); i++) {
                const file = files[i];
                const reader = new FileReader();
                
                const promise = new Promise((resolve) => {
                    reader.onload = function(e) {
                        appData.uploadedPhotos.push({
                            id: Date.now() + i,
                            url: e.target.result,
                            file: file
                        });
                        resolve();
                    };
                    reader.onerror = function() {
                        showNotification(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ ${i + 1}`, 'error');
                        resolve();
                    };
                    reader.readAsDataURL(file);
                });
                
                promises.push(promise);
            }
            
            Promise.all(promises).then(() => {
                updatePhotoPreviews();
                event.target.value = '';
            });
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–≤—å—é —Ñ–æ—Ç–æ
        function updatePhotoPreviews() {
            const container = document.getElementById('uploaded-photos-container');
            container.innerHTML = '';
            
            appData.uploadedPhotos.forEach((photo, index) => {
                const photoItem = document.createElement('div');
                photoItem.className = 'uploaded-photo-item';
                photoItem.innerHTML = `
                    <img src="${photo.url}" alt="–§–æ—Ç–æ ${index + 1}">
                    <button class="remove-photo-btn" onclick="removeUploadedPhoto(${photo.id})">√ó</button>
                `;
                container.appendChild(photoItem);
            });
            
            document.getElementById('photo-count').textContent = appData.uploadedPhotos.length;
            
            if (appData.uploadedPhotos.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; width: 100%; color: #A78BFA; padding: 20px;">
                        <i class="fas fa-images" style="font-size: 48px; opacity: 0.5; margin-bottom: 10px;"></i>
                        <div>–ù–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏"</div>
                    </div>
                `;
            }
        }
        
        // –£–¥–∞–ª–∏—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ —Ñ–æ—Ç–æ
        function removeUploadedPhoto(photoId) {
            appData.uploadedPhotos = appData.uploadedPhotos.filter(photo => photo.id !== photoId);
            updatePhotoPreviews();
            showNotification(`–§–æ—Ç–æ —É–¥–∞–ª–µ–Ω–æ (${appData.uploadedPhotos.length}/3)`, 'warning');
        }
        
        // –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É
        function clearAddForm() {
            document.getElementById('adTitle').value = '';
            document.getElementById('adCategory').value = '';
            document.getElementById('adPrice').value = '';
            document.getElementById('adDescription').value = '';
            
            appData.uploadedPhotos = [];
            updatePhotoPreviews();
            
            appData.editingAdId = null;
        }
        
        // –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
        async function publishAd() {
            const title = document.getElementById('adTitle').value.trim();
            const category = document.getElementById('adCategory').value;
            const price = parseInt(document.getElementById('adPrice').value);
            const description = document.getElementById('adDescription').value.trim();
            
            if (!title) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞!', 'error');
                return;
            }
            
            if (!category) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é!', 'error');
                return;
            }
            
            if (!price || isNaN(price) || price <= 0) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É!', 'error');
                return;
            }
            
            if (appData.uploadedPhotos.length === 0) {
                showNotification('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é!', 'error');
                return;
            }
            
            // –ï—Å–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
            if (appData.editingAdId) {
                const ad = appData.ads.find(a => a.id === appData.editingAdId);
                if (ad) {
                    ad.title = title;
                    ad.category = category;
                    ad.price = price;
                    ad.description = description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è';
                    
                    ad.photoUrls = appData.uploadedPhotos.map(p => p.url);
                    ad.photos = appData.uploadedPhotos.length;
                    
                    const success = await FirebaseMarketServer.updateAd(ad.id, {
                        title: ad.title,
                        category: ad.category,
                        price: ad.price,
                        description: ad.description,
                        photoUrls: ad.photoUrls,
                        photos: ad.photos,
                        updatedAt: firebase.database.ServerValue.TIMESTAMP
                    });
                    
                    if (success) {
                        renderAds();
                        updateProfileStats();
                        updateMyAdsList();
                        updateServerStatsUI();
                        updateAdminStats();
                        hideAddForm();
                        
                        appData.editingAdId = null;
                        showNotification('–û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ!', 'success');
                    } else {
                        showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏', 'error');
                    }
                }
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
            const newAd = {
                sellerId: appData.currentUserId,
                sellerName: appData.currentUserData.first_name + 
                           (appData.currentUserData.last_name ? ' ' + appData.currentUserData.last_name : ''),
                sellerUsername: appData.currentUserData.username ? '@' + appData.currentUserData.username : '–ë–µ–∑ username',
                sellerAvatar: appData.currentUserData.photo_url || null,
                title: title,
                category: category,
                price: price,
                description: description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è',
                photos: appData.uploadedPhotos.length,
                photoUrls: appData.uploadedPhotos.map(p => p.url),
                likes: 0,
                dislikes: 0,
                complaints: 0,
                verified: false,
                status: 'active'
            };
            
            try {
                const adId = await FirebaseMarketServer.addAd(newAd);
                
                newAd.id = adId;
                newAd.createdAt = new Date().toISOString();
                appData.ads.unshift(newAd);
                
                appData.serverStats = await FirebaseMarketServer.getStats();
                updateServerStatsUI();
                updateAdminStats();
                
                updateProfileStats();
                updateMyAdsList();
                
                renderAds();
                hideAddForm();
                
                showNotification('–û–±—ä—è–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ!', 'success');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è', 'error');
            }
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–æ—Ñ–∏–ª—è
        function updateProfileStats() {
            if (!appData.isDataLoaded) {
                document.getElementById('myAdsCount').textContent = '0';
                document.getElementById('myLikesCount').textContent = '0';
                document.getElementById('myDislikesCount').textContent = '0';
                document.getElementById('myRating').textContent = '0.0';
                return;
            }
            
            const myAds = appData.ads.filter(ad => ad.sellerId === appData.currentUserId && ad.status !== 'deleted').length;
            document.getElementById('myAdsCount').textContent = myAds;
            
            let myLikes = 0;
            let myDislikes = 0;
            
            appData.ads.forEach(ad => {
                if (ad.sellerId === appData.currentUserId) {
                    myLikes += ad.likes || 0;
                    myDislikes += ad.dislikes || 0;
                }
            });
            
            document.getElementById('myLikesCount').textContent = myLikes;
            document.getElementById('myDislikesCount').textContent = myDislikes;
            
            const myRating = calculateRating(appData.currentUserId);
            document.getElementById('myRating').textContent = myRating.toFixed(1);
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ FAQ
        function toggleFaq(id) {
            const answer = document.getElementById(`faq-answer-${id}`);
            const icon = document.getElementById(`faq-icon-${id}`);
            
            if (answer.style.display === 'none') {
                answer.style.display = 'block';
                icon.classList.replace('fa-chevron-down', 'fa-chevron-up');
                
                if (id === 5 && appData.serverStats) {
                    updateServerStatsUI();
                }
            } else {
                answer.style.display = 'none';
                icon.classList.replace('fa-chevron-up', 'fa-chevron-down');
            }
        }
        
        // –ü–æ–¥–∞—Ç—å –∂–∞–ª–æ–±—É
        function submitComplaint() {
            const message = encodeURIComponent('–•–æ—á—É –ø–æ–¥–∞—Ç—å –∂–∞–ª–æ–±—É –≤ Vape Market!');
            const telegramUrl = `https://t.me/nukm0?text=${message}`;
            
            if (tg) {
                try {
                    tg.openTelegramLink(telegramUrl);
                    showNotification('–û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —á–∞—Ç –¥–ª—è –ø–æ–¥–∞—á–∏ –∂–∞–ª–æ–±—ã', 'info');
                } catch (error) {
                    tg.showAlert(`–î–ª—è –ø–æ–¥–∞—á–∏ –∂–∞–ª–æ–±—ã –Ω–∞–ø–∏—à–∏—Ç–µ @nukm0 –≤ Telegram`);
                }
            } else {
                alert('–î–ª—è –ø–æ–¥–∞—á–∏ –∂–∞–ª–æ–±—ã –Ω–∞–ø–∏—à–∏—Ç–µ @nukm0 –≤ Telegram');
                showNotification('–ù–∞–ø–∏—à–∏—Ç–µ @nukm0 –≤ Telegram', 'info');
            }
        }
        
        // –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        function getCategoryName(category) {
            const categories = {
                'liquids': '–ñ–∏–¥–∫–æ—Å—Ç–∏',
                'disposable': '–û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞',
                'pod': '–ü–æ–¥-—Å–∏—Å—Ç–µ–º—ã',
                'consumables': '–†–∞—Å—Ö–æ–¥–Ω–∏–∫–∏'
            };
            return categories[category] || category;
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            checkTelegramAndInit();
        });
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
        document.getElementById('photoModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closePhotoModal();
            }
        });
    </script>
</body>
</html>
