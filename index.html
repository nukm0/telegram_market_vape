<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vape Market | Telegram Shop</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ç–µ–º */
        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #000000;
            --tg-theme-hint-color: #999999;
            --tg-theme-link-color: #2481cc;
            --tg-theme-button-color: #2481cc;
            --tg-theme-button-text-color: #ffffff;
            --tg-theme-secondary-bg-color: #f0f0f0;
            --tg-theme-header-bg-color: #ffffff;
        }

        [data-theme="dark"] {
            --tg-theme-bg-color: #000000;
            --tg-theme-text-color: #ffffff;
            --tg-theme-hint-color: #666666;
            --tg-theme-link-color: #6ab3f3;
            --tg-theme-button-color: #6ab3f3;
            --tg-theme-button-text-color: #000000;
            --tg-theme-secondary-bg-color: #1a1a1a;
            --tg-theme-header-bg-color: #000000;
        }

        [data-theme="light"] {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #000000;
            --tg-theme-hint-color: #999999;
            --tg-theme-link-color: #2481cc;
            --tg-theme-button-color: #2481cc;
            --tg-theme-button-text-color: #ffffff;
            --tg-theme-secondary-bg-color: #f0f0f0;
            --tg-theme-header-bg-color: #ffffff;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        body {
            background: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
            padding: 20px;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
            border-bottom: 1px solid var(--tg-theme-hint-color);
        }
        
        h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .status-card {
            background: var(--tg-theme-secondary-bg-color);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: background-color 0.3s;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--tg-theme-hint-color);
        }
        
        .status-item:last-child {
            border-bottom: none;
        }
        
        .status-label {
            font-weight: 500;
            color: var(--tg-theme-hint-color);
        }
        
        .status-value {
            font-weight: 600;
        }
        
        .success {
            color: #31b545;
        }
        
        .warning {
            color: #ffa500;
        }
        
        .error {
            color: #ff3b30;
        }
        
        .btn {
            background: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
            transition: opacity 0.3s, background-color 0.3s;
        }
        
        .btn:hover {
            opacity: 0.9;
        }
        
        .btn:active {
            opacity: 0.8;
        }
        
        .theme-test {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        
        .theme-box {
            flex: 1;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: 600;
        }
        
        .light-theme {
            background: #ffffff;
            color: #000000;
            border: 2px solid #000;
        }
        
        .dark-theme {
            background: #000000;
            color: #ffffff;
            border: 2px solid #fff;
        }
        
        .theme-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            vertical-align: middle;
        }
        
        .theme-indicator.light {
            background: #ffeb3b;
            border: 2px solid #ff9800;
        }
        
        .theme-indicator.dark {
            background: #673ab7;
            border: 2px solid #9c27b0;
        }
        
        .log {
            background: var(--tg-theme-secondary-bg-color);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .log-item {
            padding: 5px 0;
            border-bottom: 1px dashed var(--tg-theme-hint-color);
        }
        
        .log-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Vape Market</h1>
            <p>Telegram Mini App | –≠—Ç–∞–ø 1: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è SDK</p>
        </div>
        
        <div class="status-card">
            <h2>üìä –°—Ç–∞—Ç—É—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Telegram</h2>
            <div class="status-item">
                <span class="status-label">SDK –∑–∞–≥—Ä—É–∂–µ–Ω:</span>
                <span id="sdk-status" class="status-value">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
            </div>
            <div class="status-item">
                <span class="status-label">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:</span>
                <span id="platform" class="status-value">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
            <div class="status-item">
                <span class="status-label">–í–µ—Ä—Å–∏—è Telegram:</span>
                <span id="tg-version" class="status-value">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
            <div class="status-item">
                <span class="status-label">ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</span>
                <span id="user-id" class="status-value">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
            <div class="status-item">
                <span class="status-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</span>
                <span id="username" class="status-value">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
            <div class="status-item">
                <span class="status-label">–¢–µ–∫—É—â–∞—è —Ç–µ–º–∞:</span>
                <span id="theme" class="status-value">
                    <span class="theme-indicator light" id="theme-icon"></span>
                    <span id="theme-text">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                </span>
            </div>
        </div>
        
        <div class="status-card">
            <h2>üé® –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–º–æ–π</h2>
            <p>–¢–µ–º–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å Telegram</p>
            <div class="theme-test">
                <div class="theme-box light-theme">–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞</div>
                <div class="theme-box dark-theme">–¢–µ–º–Ω–∞—è —Ç–µ–º–∞</div>
            </div>
        </div>
        
        <button class="btn" onclick="showAlert()">üì¢ –¢–µ—Å—Ç: –ü–æ–∫–∞–∑–∞—Ç—å –∞–ª–µ—Ä—Ç</button>
        <button class="btn" onclick="toggleTheme()">
            <span id="toggle-theme-text">üîÑ –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É</span>
        </button>
        <button class="btn" onclick="closeApp()">‚ùå –ó–∞–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
        <button class="btn" onclick="requestPhone()">üìû –ó–∞–ø—Ä–æ—Å–∏—Ç—å –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</button>
        
        <div class="status-card">
            <h2>üìù –ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π</h2>
            <div class="log" id="event-log">
                <div class="log-item">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...</div>
            </div>
        </div>
        
        <div class="status-card">
            <h2>‚úÖ –≠—Ç–∞–ø 1: –ü—Ä–æ–≤–µ—Ä–∫–∞</h2>
            <p>–ï—Å–ª–∏ –≤—Å–µ —Å—Ç–∞—Ç—É—Å—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∑–Ω–∞—á–µ–Ω–∏—è (–Ω–µ "–ó–∞–≥—Ä—É–∑–∫–∞..."), –∑–Ω–∞—á–∏—Ç SDK —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.</p>
            <p>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫–∏ –≤—ã—à–µ –¥–ª—è —Ç–µ—Å—Ç–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Telegram.</p>
        </div>
    </div>
    
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        let currentTheme = 'light';
        
        // –ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π
        function logEvent(message) {
            const logDiv = document.getElementById('event-log');
            const logItem = document.createElement('div');
            logItem.className = 'log-item';
            logItem.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.prepend(logItem);
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
            if (logDiv.children.length > 10) {
                logDiv.removeChild(logDiv.lastChild);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º—ã
        function applyTheme(theme) {
            currentTheme = theme;
            document.documentElement.setAttribute('data-theme', theme);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç —Ö–µ–¥–µ—Ä–∞ –∏ —Ñ–æ–Ω–∞ –≤ Telegram
            if (theme === 'dark') {
                tg.setHeaderColor('#000000');
                tg.setBackgroundColor('#000000');
            } else {
                tg.setHeaderColor('#ffffff');
                tg.setBackgroundColor('#ffffff');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            updateThemeUI();
            logEvent(`–¢–µ–º–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞: ${theme === 'dark' ? '–¢–µ–º–Ω–∞—è' : '–°–≤–µ—Ç–ª–∞—è'}`);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
        function toggleTheme() {
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            applyTheme(newTheme);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ localStorage
            localStorage.setItem('user_theme_preference', newTheme);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI —Ç–µ–º—ã
        function updateThemeUI() {
            const themeIcon = document.getElementById('theme-icon');
            const themeText = document.getElementById('theme-text');
            const toggleBtn = document.getElementById('toggle-theme-text');
            
            if (currentTheme === 'dark') {
                themeIcon.className = 'theme-indicator dark';
                themeText.textContent = 'üåô –¢–µ–º–Ω–∞—è';
                toggleBtn.textContent = '‚òÄÔ∏è –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ —Å–≤–µ—Ç–ª—É—é';
            } else {
                themeIcon.className = 'theme-indicator light';
                themeText.textContent = '‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è';
                toggleBtn.textContent = 'üåô –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ —Ç–µ–º–Ω—É—é';
            }
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
        function updateStatus() {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ SDK
            const sdkLoaded = typeof tg !== 'undefined' && tg.initDataUnsafe;
            document.getElementById('sdk-status').textContent = sdkLoaded ? '‚úÖ –ì–æ—Ç–æ–≤–æ' : '‚ùå –û—à–∏–±–∫–∞';
            document.getElementById('sdk-status').className = 'status-value ' + (sdkLoaded ? 'success' : 'error');
            
            if (sdkLoaded) {
                // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ
                document.getElementById('platform').textContent = tg.platform || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                document.getElementById('tg-version').textContent = tg.version || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                
                // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                const user = tg.initDataUnsafe.user || {};
                document.getElementById('user-id').textContent = user.id || '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω';
                document.getElementById('username').textContent = user.username ? `@${user.username}` : '–ù–µ—Ç username';
            } else {
                document.getElementById('platform').textContent = '–û—à–∏–±–∫–∞ SDK';
                document.getElementById('tg-version').textContent = '–û—à–∏–±–∫–∞ SDK';
                document.getElementById('user-id').textContent = '–û—à–∏–±–∫–∞ SDK';
                document.getElementById('username').textContent = '–û—à–∏–±–∫–∞ SDK';
            }
            
            updateThemeUI();
        }
        
        // –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function showAlert() {
            tg.showAlert('–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç Telegram Mini App!');
            logEvent('–ü–æ–∫–∞–∑–∞–Ω –∞–ª–µ—Ä—Ç');
        }
        
        function closeApp() {
            logEvent('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ');
            tg.close();
        }
        
        function requestPhone() {
            if (tg.initDataUnsafe.user) {
                tg.showPopup({
                    title: '–ó–∞–ø—Ä–æ—Å –Ω–æ–º–µ—Ä–∞',
                    message: '–†–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞?',
                    buttons: [
                        {id: 'yes', type: 'ok', text: '–†–∞–∑—Ä–µ—à–∏—Ç—å'},
                        {id: 'no', type: 'cancel', text: '–û—Ç–º–µ–Ω–∞'}
                    ]
                }, (buttonId) => {
                    if (buttonId === 'yes') {
                        tg.requestContact((contact) => {
                            if (contact) {
                                tg.showAlert(`–ù–æ–º–µ—Ä –ø–æ–ª—É—á–µ–Ω: ${contact.phone_number}`);
                                logEvent(`–ü–æ–ª—É—á–µ–Ω –Ω–æ–º–µ—Ä: ${contact.phone_number}`);
                            }
                        });
                    }
                });
            } else {
                tg.showAlert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function initApp() {
            logEvent('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è');
            
            // –†–∞—Å—à–∏—Ä—è–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
            tg.expand();
            logEvent('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–æ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
            tg.BackButton.show();
            tg.BackButton.onClick(() => {
                logEvent('–ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥"');
                tg.close();
            });
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é —Ç–µ–º—É
            let initialTheme = tg.colorScheme;
            const savedTheme = localStorage.getItem('user_theme_preference');
            
            // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è —Ç–µ–º–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è > —Ç–µ–º–∞ Telegram > —Å–≤–µ—Ç–ª–∞—è
            if (savedTheme && (savedTheme === 'dark' || savedTheme === 'light')) {
                initialTheme = savedTheme;
                logEvent(`–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è —Ç–µ–º–∞: ${savedTheme}`);
            } else {
                logEvent(`–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–Ω–∞—è —Ç–µ–º–∞ Telegram: ${initialTheme}`);
            }
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É
            applyTheme(initialTheme);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            updateStatus();
            
            // –°–ª—É—à–∞–µ–º —Å–º–µ–Ω—É —Ç–µ–º—ã Telegram
            tg.onEvent('themeChanged', (eventData) => {
                logEvent(`Telegram –∏–∑–º–µ–Ω–∏–ª —Ç–µ–º—É –Ω–∞: ${eventData.theme}`);
                applyTheme(eventData.theme);
            });
            
            logEvent('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É SDK
            setTimeout(initApp, 100);
        });
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
        setInterval(updateStatus, 3000);
    </script>
</body>
</html>
