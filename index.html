<<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vape Market | Telegram Bot</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
            --dark-gradient: linear-gradient(135deg, #6D28D9 0%, #5B21B6 100%);
            --accent-color: #8B5CF6;
            --accent-hover: #7C3AED;
            --success-color: #10B981;
            --danger-color: #EF4444;
            --warning-color: #F59E0B;
            
            --bg-primary: #1F2937;
            --bg-secondary: #374151;
            --bg-card: rgba(255, 255, 255, 0.05);
            --text-primary: #FFFFFF;
            --text-secondary: #D1D5DB;
            --text-muted: #9CA3AF;
            
            --shadow: 0 4px 20px rgba(139, 92, 246, 0.15);
            --shadow-dark: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        html, body {
            height: 100%;
            overflow: hidden;
            background: var(--bg-primary);
            color: var(--text-primary);
        }
        
        .app-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            max-width: 500px;
            margin: 0 auto;
            background: var(--bg-primary);
        }
        
        /* Шапка */
        .app-header {
            background: var(--dark-gradient);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow-dark);
            position: relative;
            z-index: 10;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            width: 36px;
            height: 36px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .logo-text {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(90deg, #FFFFFF, #E9D5FF);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .bot-link {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            text-decoration: none;
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .bot-link:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* Контент */
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            position: relative;
        }
        
        /* Категории */
        .categories-section {
            margin-bottom: 20px;
        }
        
        .categories {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px 0;
            scrollbar-width: none;
        }
        
        .categories::-webkit-scrollbar {
            display: none;
        }
        
        .category-btn {
            padding: 12px 20px;
            border-radius: 15px;
            background: var(--bg-card);
            border: 2px solid rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            font-weight: 600;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .category-btn:hover {
            border-color: var(--accent-color);
            transform: translateY(-2px);
        }
        
        .category-btn.active {
            background: var(--accent-color);
            border-color: var(--accent-color);
        }
        
        /* Карточка объявления */
        .ad-card {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .ad-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
            border-color: rgba(139, 92, 246, 0.3);
        }
        
        /* Продавец */
        .seller-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .seller-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }
        
        .seller-details {
            flex: 1;
        }
        
        .seller-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .seller-stats {
            display: flex;
            gap: 15px;
            font-size: 13px;
        }
        
        .seller-stat {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--text-secondary);
        }
        
        .seller-stat i {
            font-size: 14px;
        }
        
        .stat-likes { color: var(--success-color); }
        .stat-dislikes { color: var(--danger-color); }
        .stat-rating { color: var(--warning-color); }
        
        /* Превью фото */
        .photo-preview {
            position: relative;
            height: 200px;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.2);
        }
        
        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .photo-counter {
            position: absolute;
            bottom: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .view-photos-btn {
            position: absolute;
            bottom: 15px;
            left: 15px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        .view-photos-btn:hover {
            background: rgba(0, 0, 0, 0.9);
        }
        
        .photo-dots {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
        }
        
        .photo-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transition: all 0.3s ease;
        }
        
        .photo-dot.active {
            background: var(--accent-color);
            width: 20px;
            border-radius: 10px;
        }
        
        /* Детали товара */
        .product-details {
            margin-bottom: 20px;
        }
        
        .product-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 10px;
            line-height: 1.3;
        }
        
        .product-category {
            display: inline-block;
            padding: 6px 15px;
            background: rgba(139, 92, 246, 0.2);
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--accent-color);
        }
        
        .product-price {
            font-size: 28px;
            font-weight: 800;
            color: var(--success-color);
            margin-bottom: 15px;
        }
        
        .product-description {
            font-size: 15px;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        /* Действия */
        .actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .action-btn {
            flex: 1;
            padding: 15px;
            border-radius: 15px;
            border: none;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 15px;
        }
        
        .like-btn {
            background: rgba(16, 185, 129, 0.15);
            border: 2px solid rgba(16, 185, 129, 0.3);
            color: var(--success-color);
        }
        
        .like-btn:hover, .like-btn.active {
            background: var(--success-color);
            color: white;
        }
        
        .contact-btn {
            background: var(--accent-color);
            border: 2px solid var(--accent-color);
        }
        
        .contact-btn:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
        }
        
        .dislike-btn {
            background: rgba(239, 68, 68, 0.15);
            border: 2px solid rgba(239, 68, 68, 0.3);
            color: var(--danger-color);
        }
        
        .dislike-btn:hover, .dislike-btn.active {
            background: var(--danger-color);
            color: white;
        }
        
        /* Нижняя навигация */
        .bottom-nav {
            background: var(--bg-secondary);
            display: flex;
            padding: 10px 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            z-index: 10;
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px 5px;
            border-radius: 12px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            position: relative;
        }
        
        .nav-item.active {
            color: var(--accent-color);
        }
        
        .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 3px;
            background: var(--accent-color);
            border-radius: 3px;
        }
        
        .nav-icon {
            font-size: 22px;
            margin-bottom: 5px;
        }
        
        .nav-label {
            font-size: 11px;
            font-weight: 600;
        }
        
        /* Страницы */
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        /* Личный кабинет */
        .profile-section {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
        }
        
        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
            padding-bottom: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .profile-avatar-large {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            flex-shrink: 0;
        }
        
        .profile-info h2 {
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .profile-info p {
            font-size: 15px;
            color: var(--text-secondary);
        }
        
        .profile-stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .profile-stat-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .stat-number {
            display: block;
            font-size: 28px;
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 13px;
            color: var(--text-muted);
        }
        
        /* FAQ страница */
        .faq-section {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 25px;
        }
        
        .faq-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .faq-header-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .faq-header-text h2 {
            font-size: 22px;
            margin-bottom: 5px;
        }
        
        .faq-header-text p {
            color: var(--text-secondary);
            font-size: 15px;
        }
        
        .faq-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .faq-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }
        
        .faq-item:hover {
            border-color: rgba(139, 92, 246, 0.3);
            transform: translateY(-2px);
        }
        
        .faq-question {
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 16px;
        }
        
        .faq-answer {
            margin-top: 15px;
            color: var(--text-secondary);
            font-size: 15px;
            line-height: 1.6;
        }
        
        .complaint-btn {
            width: 100%;
            padding: 18px;
            border-radius: 15px;
            background: rgba(239, 68, 68, 0.15);
            border: 2px solid rgba(239, 68, 68, 0.3);
            color: var(--danger-color);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 25px;
            font-size: 16px;
        }
        
        .complaint-btn:hover {
            background: var(--danger-color);
            color: white;
            transform: translateY(-2px);
        }
        
        /* Модальное окно фото */
        .photo-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .photo-modal.active {
            display: flex;
        }
        
        .photo-modal-content {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .modal-photo {
            max-width: 100%;
            max-height: 80%;
            object-fit: contain;
            border-radius: 10px;
        }
        
        .modal-close {
            position: absolute;
            top: 30px;
            right: 30px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .modal-counter {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 500;
        }
        
        .modal-nav {
            position: absolute;
            top: 50%;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 30px;
            transform: translateY(-50%);
        }
        
        .modal-nav-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .modal-nav-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* Скроллбар */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 10px;
        }
        
        /* Уведомление */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: var(--bg-secondary);
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            z-index: 1001;
            transition: transform 0.5s ease;
            box-shadow: var(--shadow-dark);
            max-width: 90%;
            text-align: center;
            border-left: 4px solid var(--accent-color);
        }
        
        .notification.show {
            transform: translateX(-50%) translateY(0);
        }
        
        /* Загрузка */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Шапка -->
        <header class="app-header">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-smoking"></i>
                </div>
                <div class="logo-text">Vape Market</div>
            </div>
            <a href="https://t.me/market_vape_1_bot" class="bot-link" target="_blank">
                <i class="fab fa-telegram"></i>
                <span>@market_vape_1_bot</span>
            </a>
        </header>

        <!-- Основной контент -->
        <main class="main-content" id="main-content">
            <!-- Страница 1: Объявления -->
            <div class="page active" id="page-ads">
                <!-- Категории -->
                <div class="categories-section">
                    <div class="categories">
                        <button class="category-btn active" onclick="filterCategory('all')">Все</button>
                        <button class="category-btn" onclick="filterCategory('liquids')">Жидкости</button>
                        <button class="category-btn" onclick="filterCategory('disposable')">Одноразовые</button>
                        <button class="category-btn" onclick="filterCategory('pod')">Под-системы</button>
                        <button class="category-btn" onclick="filterCategory('consumables')">Расходники</button>
                        <button class="category-btn" onclick="filterCategory('mods')">Моды</button>
                        <button class="category-btn" onclick="filterCategory('atomizers')">Атомайзеры</button>
                    </div>
                </div>

                <!-- Контейнер объявлений -->
                <div id="ads-container">
                    <!-- Объявления загружаются динамически -->
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>Загрузка объявлений...</div>
                    </div>
                </div>
            </div>

            <!-- Страница 2: Личный кабинет -->
            <div class="page" id="page-profile">
                <div class="profile-section">
                    <div class="profile-header">
                        <div class="profile-avatar-large">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="profile-info">
                            <h2 id="profileName">Максим Вейперов</h2>
                            <p id="profileUsername">@vape_lover</p>
                            <div class="seller-stat stat-rating">
                                <i class="fas fa-star"></i>
                                <span id="myRating">4.7</span>
                            </div>
                        </div>
                    </div>

                    <div class="profile-stats-grid">
                        <div class="profile-stat-card">
                            <div class="stat-number" id="myAdsCount">12</div>
                            <div class="stat-label">Объявления</div>
                        </div>
                        <div class="profile-stat-card">
                            <div class="stat-number" id="myLikesCount">156</div>
                            <div class="stat-label">Лайки</div>
                        </div>
                        <div class="profile-stat-card">
                            <div class="stat-number" id="myDislikesCount">8</div>
                            <div class="stat-label">Дизлайки</div>
                        </div>
                    </div>

                    <!-- Мои объявления -->
                    <h3 style="margin-bottom: 20px; color: var(--text-primary);">Мои объявления</h3>
                    <div id="myAdsList">
                        <!-- Объявления пользователя -->
                    </div>
                </div>
            </div>

            <!-- Страница 3: FAQ -->
            <div class="page" id="page-faq">
                <div class="faq-section">
                    <div class="faq-header">
                        <div class="faq-header-icon">
                            <i class="fas fa-question-circle"></i>
                        </div>
                        <div class="faq-header-text">
                            <h2>Помощь и поддержка</h2>
                            <p>Часто задаваемые вопросы</p>
                        </div>
                    </div>

                    <div class="faq-list">
                        <div class="faq-item" onclick="toggleFaq(1)">
                            <div class="faq-question">
                                <span>Как разместить объявление?</span>
                                <i class="fas fa-chevron-down" id="faq-icon-1"></i>
                            </div>
                            <div class="faq-answer" id="faq-answer-1" style="display: none;">
                                Напишите боту @market_vape_1_bot и следуйте инструкциям для размещения объявления.
                            </div>
                        </div>
                        
                        <div class="faq-item" onclick="toggleFaq(2)">
                            <div class="faq-question">
                                <span>Как работает рейтинг продавцов?</span>
                                <i class="fas fa-chevron-down" id="faq-icon-2"></i>
                            </div>
                            <div class="faq-answer" id="faq-answer-2" style="display: none;">
                                Рейтинг рассчитывается по формуле: 0.1 + (лайки / (лайки + дизлайки)) × 4.9.
                                Каждый пользователь может поставить только одну оценку.
                            </div>
                        </div>
                        
                        <div class="faq-item" onclick="toggleFaq(3)">
                            <div class="faq-question">
                                <span>Как связаться с продавцом?</span>
                                <i class="fas fa-chevron-down" id="faq-icon-3"></i>
                            </div>
                            <div class="faq-answer" id="faq-answer-3" style="display: none;">
                                Нажмите кнопку "Написать продавцу" под объявлением. Откроется Telegram-чат с готовым сообщением.
                            </div>
                        </div>
                        
                        <div class="faq-item" onclick="toggleFaq(4)">
                            <div class="faq-question">
                                <span>Как просмотреть все фото товара?</span>
                                <i class="fas fa-chevron-down" id="faq-icon-4"></i>
                            </div>
                            <div class="faq-answer" id="faq-answer-4" style="display: none;">
                                Нажмите на фото в объявлении или кнопку "Просмотр фото". Откроется галерея с возможностью листать все фото.
                            </div>
                        </div>
                        
                        <div class="faq-item" onclick="toggleFaq(5)">
                            <div class="faq-question">
                                <span>Как оплатить товар?</span>
                                <i class="fas fa-chevron-down" id="faq-icon-5"></i>
                            </div>
                            <div class="faq-answer" id="faq-answer-5" style="display: none;">
                                Все сделки происходят напрямую с продавцом в Telegram. Обсуждайте способы оплаты в личном чате.
                            </div>
                        </div>
                    </div>

                    <!-- Кнопка жалобы -->
                    <button class="complaint-btn" onclick="submitComplaint()">
                        <i class="fas fa-exclamation-triangle"></i>
                        Подать жалобу
                    </button>
                </div>
            </div>
        </main>

        <!-- Нижняя навигация -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-page="ads" onclick="switchPage('ads')">
                <div class="nav-icon">
                    <i class="fas fa-box-open"></i>
                </div>
                <span class="nav-label">Объявления</span>
            </button>
            
            <button class="nav-item" data-page="profile" onclick="switchPage('profile')">
                <div class="nav-icon">
                    <i class="fas fa-user-circle"></i>
                </div>
                <span class="nav-label">Кабинет</span>
            </button>
            
            <button class="nav-item" data-page="faq" onclick="switchPage('faq')">
                <div class="nav-icon">
                    <i class="fas fa-question-circle"></i>
                </div>
                <span class="nav-label">FAQ</span>
            </button>
        </nav>

        <!-- Модальное окно для просмотра фото -->
        <div class="photo-modal" id="photoModal">
            <div class="photo-modal-content">
                <button class="modal-close" onclick="closePhotoModal()">
                    <i class="fas fa-times"></i>
                </button>
                <div class="modal-nav">
                    <button class="modal-nav-btn" onclick="prevPhoto()">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button class="modal-nav-btn" onclick="nextPhoto()">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <img class="modal-photo" id="modalPhoto" src="" alt="Просмотр фото">
                <div class="modal-counter" id="photoCounter">1 / 1</div>
            </div>
        </div>

        <!-- Уведомление -->
        <div class="notification" id="notification"></div>
    </div>

    <script>
        // Инициализация Telegram
        const tg = window.Telegram?.WebApp;
        
        // Система данных приложения
        const appData = {
            currentUserId: null,
            ads: [],
            currentAds: [],
            userRatings: {},
            currentCategory: 'all',
            currentPhotoList: [],
            currentPhotoIndex: 0,
            userProfile: {
                name: 'Максим Вейперов',
                username: '@vape_lover',
                rating: 4.7,
                adsCount: 12,
                likes: 156,
                dislikes: 8
            }
        };
        
        // Инициализация тестовых данных
        function initializeTestData() {
            appData.ads = [
                {
                    id: 1,
                    sellerId: 'seller1',
                    sellerName: 'Алексей Паров',
                    sellerUsername: '@vape_pro',
                    title: 'Жидкость для вейпа "Arctic Berry" 60ml',
                    category: 'liquids',
                    price: 850,
                    description: 'Премиальная жидкость для вейпа, крепость 3mg. Свежий вкус арктических ягод с ментоловым послевкусием.',
                    photos: 3,
                    photoUrls: [
                        'https://images.unsplash.com/photo-1583608205776-bfd35f0d9f83?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80',
                        'https://images.unsplash.com/photo-1606041008023-472dfb5e530f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80',
                        'https://images.unsplash.com/photo-1513104890138-7c749659a591?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80'
                    ],
                    likes: 24,
                    dislikes: 2,
                    views: 156,
                    rating: 4.8
                },
                {
                    id: 2,
                    sellerId: 'seller2',
                    sellerName: 'Ирина Смокова',
                    sellerUsername: '@smoke_queen',
                    title: 'Elf Bar BC5000 (Blue Razz Ice)',
                    category: 'disposable',
                    price: 1250,
                    description: 'Одноразовый вейп Elf Bar BC5000, вкус Blue Razz Ice (голубая малина+ментол). Новый в оригинальной упаковке.',
                    photos: 2,
                    photoUrls: [
                        'https://images.unsplash.com/photo-1606756790138-2615c22b5a8f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80',
                        'https://images.unsplash.com/photo-1571330735066-03f0d47dab3d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80'
                    ],
                    likes: 18,
                    dislikes: 1,
                    views: 98,
                    rating: 4.9
                },
                {
                    id: 3,
                    sellerId: 'seller3',
                    sellerName: 'Дмитрий Подсистемин',
                    sellerUsername: '@pod_master',
                    title: 'Vaporesso XROS 3 Mini Pod Kit',
                    category: 'pod',
                    price: 3200,
                    description: 'Под-система Vaporesso XROS 3 Mini, градиентный синий цвет. В идеальном состоянии, использовался 2 недели.',
                    photos: 4,
                    photoUrls: [
                        'https://images.unsplash.com/photo-1569234960285-0d53d04e9764?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80',
                        'https://images.unsplash.com/photo-1583608205776-bfd35f0d9f83?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80',
                        'https://images.unsplash.com/photo-1606756790138-2615c22b5a8f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80',
                        'https://images.unsplash.com/photo-1571330735066-03f0d47dab3d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80'
                    ],
                    likes: 32,
                    dislikes: 3,
                    views: 210,
                    rating: 4.7
                },
                {
                    id: 4,
                    sellerId: 'seller4',
                    sellerName: 'Сергей Расходников',
                    sellerUsername: '@vape_supplies',
                    title: 'Набор испарителей для SMOK',
                    category: 'consumables',
                    price: 450,
                    description: 'Набор из 5 испарителей для SMOK Nord 4. Оригинальные, новые в упаковке.',
                    photos: 1,
                    photoUrls: [
                        'https://images.unsplash.com/photo-1513104890138-7c749659a591?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80'
                    ],
                    likes: 15,
                    dislikes: 0,
                    views: 76,
                    rating: 5.0
                },
                {
                    id: 5,
                    sellerId: 'seller5',
                    sellerName: 'Максим Вейперов',
                    sellerUsername: '@vape_lover',
                    title: 'GeekVape Aegis Legend 2',
                    category: 'mods',
                    price: 5200,
                    description: 'Мод GeekVape Aegis Legend 2, защита от воды и ударов. В отличном состоянии, полный комплект.',
                    photos: 3,
                    photoUrls: [
                        'https://images.unsplash.com/photo-1569234960285-0d53d04e9764?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80',
                        'https://images.unsplash.com/photo-1571330735066-03f0d47dab3d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80',
                        'https://images.unsplash.com/photo-1513104890138-7c749659a591?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80'
                    ],
                    likes: 42,
                    dislikes: 5,
                    views: 189,
                    rating: 4.6
                }
            ];
            
            // Инициализируем рейтинги
            appData.userRatings = {
                'seller1': {},
                'seller2': {},
                'seller3': {},
                'seller4': {},
                'seller5': {}
            };
            
            // Копируем все объявления в currentAds
            appData.currentAds = [...appData.ads];
        }
        
        // Показать уведомление
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
            
            console.log(`Уведомление: ${message}`);
        }
        
        // Переключение страниц
        function switchPage(page) {
            // Скрыть все страницы
            document.querySelectorAll('.page').forEach(p => {
                p.classList.remove('active');
            });
            
            // Показать выбранную страницу
            document.getElementById(`page-${page}`).classList.add('active');
            
            // Обновить активную кнопку в меню
            document.querySelectorAll('.nav-item').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-page="${page}"]`).classList.add('active');
            
            // Обновить заголовок
            const titles = {
                'ads': 'Vape Market',
                'profile': 'Личный кабинет',
                'faq': 'Помощь'
            };
            
            // Если страница профиля, обновляем данные
            if (page === 'profile') {
                updateMyAdsList();
            }
            
            // Если страница FAQ, открываем первый вопрос
            if (page === 'faq') {
                setTimeout(() => toggleFaq(1), 100);
            }
        }
        
        // Фильтр по категориям
        function filterCategory(category) {
            appData.currentCategory = category;
            
            // Обновить активную кнопку категории
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Фильтруем объявления
            if (category === 'all') {
                appData.currentAds = [...appData.ads];
            } else {
                appData.currentAds = appData.ads.filter(ad => ad.category === category);
            }
            
            // Обновляем отображение
            renderAds();
        }
        
        // Рендер объявлений
        function renderAds() {
            const container = document.getElementById('ads-container');
            
            if (appData.currentAds.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <i class="fas fa-box-open" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
                        <h3 style="margin-bottom: 10px;">Нет объявлений</h3>
                        <p>В этой категории пока нет объявлений</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            appData.currentAds.forEach(ad => {
                // Рассчитываем рейтинг по формуле
                const rating = calculateRating(ad.sellerId);
                
                // Проверяем, поставил ли текущий пользователь оценку
                const userRating = appData.currentUserId 
                    ? appData.userRatings[ad.sellerId]?.[appData.currentUserId]
                    : null;
                
                // Создаем точки для индикатора фото
                const photoDots = [];
                for (let i = 0; i < ad.photos; i++) {
                    photoDots.push(`<div class="photo-dot ${i === 0 ? 'active' : ''}"></div>`);
                }
                
                const adElement = document.createElement('div');
                adElement.className = 'ad-card';
                adElement.innerHTML = `
                    <div class="seller-info">
                        <div class="seller-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="seller-details">
                            <div class="seller-name">${ad.sellerName}</div>
                            <div class="seller-stats">
                                <div class="seller-stat stat-rating">
                                    <i class="fas fa-star"></i>
                                    <span>${rating.toFixed(1)}</span>
                                </div>
                                <div class="seller-stat stat-likes">
                                    <i class="fas fa-thumbs-up"></i>
                                    <span>${ad.likes}</span>
                                </div>
                                <div class="seller-stat stat-dislikes">
                                    <i class="fas fa-thumbs-down"></i>
                                    <span>${ad.dislikes}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="photo-preview">
                        <img src="${ad.photoUrls[0]}" alt="${ad.title}" 
                             onclick="openPhotoViewer(${ad.id})">
                        <button class="view-photos-btn" onclick="openPhotoViewer(${ad.id})">
                            <i class="fas fa-images"></i>
                            Просмотр фото
                        </button>
                        <div class="photo-counter">1 / ${ad.photos}</div>
                        <div class="photo-dots">${photoDots.join('')}</div>
                    </div>

                    <div class="product-details">
                        <div class="product-title">${ad.title}</div>
                        <div class="product-category">${getCategoryName(ad.category)}</div>
                        <div class="product-price">${ad.price.toLocaleString()} ₽</div>
                        <div class="product-description">${ad.description}</div>
                    </div>

                    <div class="actions">
                        <button class="action-btn like-btn ${userRating === 'like' ? 'active' : ''}" 
                                onclick="rateAd(${ad.id}, 'like')">
                            <i class="fas fa-thumbs-up"></i>
                            <span>${ad.likes}</span>
                        </button>
                        
                        <button class="action-btn contact-btn" 
                                onclick="contactSeller('${ad.sellerUsername}', ${ad.id}, '${ad.title}', '${ad.category}')">
                            <i class="fas fa-paper-plane"></i>
                            Написать
                        </button>
                        
                        <button class="action-btn dislike-btn ${userRating === 'dislike' ? 'active' : ''}" 
                                onclick="rateAd(${ad.id}, 'dislike')">
                            <i class="fas fa-thumbs-down"></i>
                            <span>${ad.dislikes}</span>
                        </button>
                    </div>
                `;
                
                container.appendChild(adElement);
            });
        }
        
        // Рассчитать рейтинг по формуле
        function calculateRating(sellerId) {
            if (!appData.userRatings[sellerId]) return 0.1;
            
            const ratings = Object.values(appData.userRatings[sellerId]);
            if (ratings.length === 0) return 0.1;
            
            const likes = ratings.filter(r => r === 'like').length;
            const dislikes = ratings.filter(r => r === 'dislike').length;
            const total = likes + dislikes;
            
            // Формула: 0.1 + (лайки / (лайки + дизлайки)) * 4.9
            if (total === 0) return 0.1;
            
            const ratio = likes / total;
            return 0.1 + ratio * 4.9;
        }
        
        // Оценить объявление
        function rateAd(adId, type) {
            if (!appData.currentUserId) {
                appData.currentUserId = 'user_' + Date.now();
            }
            
            const ad = appData.ads.find(a => a.id === adId);
            if (!ad) return;
            
            const userRating = appData.userRatings[ad.sellerId]?.[appData.currentUserId];
            
            if (userRating === type) {
                showNotification('Вы уже поставили эту оценку', 'warning');
                return;
            }
            
            // Удаляем предыдущую оценку если была
            if (userRating === 'like') {
                ad.likes--;
            } else if (userRating === 'dislike') {
                ad.dislikes--;
            }
            
            // Добавляем новую оценку
            if (type === 'like') {
                ad.likes++;
            } else {
                ad.dislikes++;
            }
            
            // Сохраняем оценку
            if (!appData.userRatings[ad.sellerId]) {
                appData.userRatings[ad.sellerId] = {};
            }
            appData.userRatings[ad.sellerId][appData.currentUserId] = type;
            
            // Обновляем отображение
            renderAds();
            
            // Анимация кнопки
            const btn = event.currentTarget;
            btn.style.transform = 'scale(1.1)';
            setTimeout(() => {
                btn.style.transform = 'scale(1)';
            }, 300);
            
            showNotification(`Вы поставили ${type === 'like' ? 'лайк' : 'дизлайк'}`, 'success');
        }
        
        // Открыть просмотр фото
        function openPhotoViewer(adId, photoIndex = 0) {
            const ad = appData.ads.find(a => a.id === adId);
            if (!ad || !ad.photoUrls || ad.photoUrls.length === 0) {
                showNotification('Фотографии не найдены', 'error');
                return;
            }
            
            appData.currentPhotoList = ad.photoUrls;
            appData.currentPhotoIndex = photoIndex;
            
            const modal = document.getElementById('photoModal');
            const modalImg = document.getElementById('modalPhoto');
            const counter = document.getElementById('photoCounter');
            
            modalImg.src = ad.photoUrls[photoIndex];
            counter.textContent = `${photoIndex + 1} / ${ad.photoUrls.length}`;
            
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        // Закрыть просмотр фото
        function closePhotoModal() {
            const modal = document.getElementById('photoModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }
        
        // Следующее фото
        function nextPhoto() {
            if (appData.currentPhotoList.length === 0) return;
            
            appData.currentPhotoIndex = (appData.currentPhotoIndex + 1) % appData.currentPhotoList.length;
            document.getElementById('modalPhoto').src = appData.currentPhotoList[appData.currentPhotoIndex];
            document.getElementById('photoCounter').textContent = 
                `${appData.currentPhotoIndex + 1} / ${appData.currentPhotoList.length}`;
        }
        
        // Предыдущее фото
        function prevPhoto() {
            if (appData.currentPhotoList.length === 0) return;
            
            appData.currentPhotoIndex = appData.currentPhotoIndex === 0 
                ? appData.currentPhotoList.length - 1 
                : appData.currentPhotoIndex - 1;
            
            document.getElementById('modalPhoto').src = appData.currentPhotoList[appData.currentPhotoIndex];
            document.getElementById('photoCounter').textContent = 
                `${appData.currentPhotoIndex + 1} / ${appData.currentPhotoList.length}`;
        }
        
        // Написать продавцу
        function contactSeller(username, adId, adTitle, category) {
            // Формируем сообщение
            const categoryName = getCategoryName(category);
            const message = `Привет! Я пишу по объявлению "${adTitle}" с приложения Vape Market в Telegram по категории ${categoryName}. Интересуюсь товаром, можно подробнее?`;
            
            // Открываем чат в Telegram с готовым сообщением
            if (tg) {
                try {
                    const cleanUsername = username.replace('@', '');
                    const encodedMessage = encodeURIComponent(message);
                    const telegramUrl = `https://t.me/${cleanUsername}?text=${encodedMessage}`;
                    
                    tg.openTelegramLink(telegramUrl);
                    showNotification(`Открывается чат с ${username}`, 'success');
                } catch (error) {
                    tg.showAlert(`Для теста: откроется чат с ${username}\n\nСообщение: ${message}`);
                }
            } else {
                // Для теста в браузере
                alert(`Сообщение для ${username}:\n\n${message}\n\n(В Telegram Mini App сообщение автоматически добавится в чат)`);
                showNotification(`Тест: сообщение для ${username}`, 'info');
            }
        }
        
        // Обновить список моих объявлений
        function updateMyAdsList() {
            const myAdsList = document.getElementById('myAdsList');
            
            // Фильтруем объявления текущего пользователя (имитация)
            const myAds = appData.ads.filter(ad => ad.sellerId === 'seller5');
            
            if (myAds.length === 0) {
                myAdsList.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: var(--text-secondary);">
                        <i class="fas fa-box-open" style="font-size: 36px; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>У вас пока нет объявлений</p>
                    </div>
                `;
                return;
            }
            
            myAdsList.innerHTML = '';
            
            myAds.forEach(ad => {
                const adElement = document.createElement('div');
                adElement.className = 'ad-card';
                adElement.style.marginBottom = '15px';
                
                const rating = calculateRating(ad.sellerId);
                
                adElement.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                        <div>
                            <div style="font-weight: 600; margin-bottom: 5px;">${ad.title}</div>
                            <div class="product-category" style="display: inline-block;">${getCategoryName(ad.category)}</div>
                        </div>
                        <div style="font-size: 22px; font-weight: 700; color: var(--success-color);">${ad.price.toLocaleString()} ₽</div>
                    </div>
                    <div style="color: var(--text-secondary); font-size: 14px; margin-bottom: 15px;">${ad.description}</div>
                    <div style="display: flex; gap: 15px; font-size: 13px; color: var(--text-muted);">
                        <div><i class="fas fa-eye"></i> ${ad.views}</div>
                        <div><i class="fas fa-thumbs-up"></i> ${ad.likes}</div>
                        <div><i class="fas fa-thumbs-down"></i> ${ad.dislikes}</div>
                        <div><i class="fas fa-star"></i> ${rating.toFixed(1)}</div>
                    </div>
                `;
                
                myAdsList.appendChild(adElement);
            });
        }
        
        // Переключение FAQ
        function toggleFaq(id) {
            const answer = document.getElementById(`faq-answer-${id}`);
            const icon = document.getElementById(`faq-icon-${id}`);
            
            if (answer.style.display === 'none') {
                answer.style.display = 'block';
                icon.classList.replace('fa-chevron-down', 'fa-chevron-up');
            } else {
                answer.style.display = 'none';
                icon.classList.replace('fa-chevron-up', 'fa-chevron-down');
            }
        }
        
        // Подать жалобу
        function submitComplaint() {
            const message = encodeURIComponent('Хочу подать жалобу!');
            const telegramUrl = `https://t.me/nukm0?start=${message}`;
            
            if (tg) {
                try {
                    tg.openTelegramLink(telegramUrl);
                    showNotification('Открывается чат для подачи жалобы', 'info');
                } catch (error) {
                    tg.showAlert(`Для подачи жалобы напишите @nukm0 в Telegram с текстом: "Хочу подать жалобу!"`);
                }
            } else {
                alert('Для подачи жалобы напишите @nukm0 в Telegram с текстом: "Хочу подать жалобу!"');
                showNotification('Напишите @nukm0 в Telegram', 'info');
            }
        }
        
        // Вспомогательные функции
        function getCategoryName(category) {
            const categories = {
                'liquids': 'Жидкости',
                'disposable': 'Одноразовые',
                'pod': 'Под-системы',
                'consumables': 'Расходники',
                'mods': 'Моды',
                'atomizers': 'Атомайзеры'
            };
            return categories[category] || category;
        }
        
        // Инициализация приложения
        function initApp() {
            if (tg) {
                tg.expand();
                tg.setHeaderColor('#6D28D9');
                tg.setBackgroundColor('#1F2937');
                
                // Получаем данные пользователя из Telegram
                const user = tg.initDataUnsafe?.user;
                if (user) {
                    const profileName = document.getElementById('profileName');
                    const profileUsername = document.getElementById('profileUsername');
                    
                    if (user.first_name) {
                        profileName.textContent = user.first_name + (user.last_name ? ' ' + user.last_name : '');
                        appData.userProfile.name = user.first_name + (user.last_name ? ' ' + user.last_name : '');
                    }
                    
                    if (user.username) {
                        profileUsername.textContent = `@${user.username}`;
                        appData.userProfile.username = `@${user.username}`;
                    }
                    
                    // Используем Telegram ID как идентификатор пользователя
                    appData.currentUserId = `tg_${user.id}`;
                }
            }
            
            // Инициализация тестовых данных
            initializeTestData();
            
            // Рендерим объявления
            setTimeout(() => {
                renderAds();
            }, 500);
            
            // Инициализация FAQ (все ответы скрыты)
            for (let i = 1; i <= 5; i++) {
                document.getElementById(`faq-answer-${i}`).style.display = 'none';
            }
            
            showNotification('Добро пожаловать в Vape Market!', 'success');
            
            // Устанавливаем заголовок
            document.title = 'Vape Market | @market_vape_1_bot';
        }
        
        // Запуск при загрузке
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });
        
        // Закрытие модального окна по ESC
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closePhotoModal();
            }
        });
    </script>
</body>
</html>
